(function(e){function t(t){for(var s,o,n=t[0],l=t[1],c=t[2],m=0,u=[];m<n.length;m++)o=n[m],i[o]&&u.push(i[o][0]),i[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);while(u.length)u.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],s=!0,o=1;o<a.length;o++){var n=a[o];0!==i[n]&&(s=!1)}s&&(r.splice(t--,1),e=l(l.s=a[0]))}return e}var s={},o={app:0},i={app:0},r=[];function n(e){return l.p+"js/"+({}[e]||e)+"."+{"chunk-66d754ac":"825afc1f"}[e]+".js"}function l(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.e=function(e){var t=[],a={"chunk-66d754ac":1};o[e]?t.push(o[e]):0!==o[e]&&a[e]&&t.push(o[e]=new Promise(function(t,a){for(var s="css/"+({}[e]||e)+"."+{"chunk-66d754ac":"395464eb"}[e]+".css",i=l.p+s,r=document.getElementsByTagName("link"),n=0;n<r.length;n++){var c=r[n],m=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(m===s||m===i))return t()}var u=document.getElementsByTagName("style");for(n=0;n<u.length;n++){c=u[n],m=c.getAttribute("data-href");if(m===s||m===i)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var s=t&&t.target&&t.target.src||i,r=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");r.request=s,delete o[e],d.parentNode.removeChild(d),a(r)},d.href=i;var p=document.getElementsByTagName("head")[0];p.appendChild(d)}).then(function(){o[e]=0}));var s=i[e];if(0!==s)if(s)t.push(s[2]);else{var r=new Promise(function(t,a){s=i[e]=[t,a]});t.push(s[2]=r);var c,m=document.createElement("script");m.charset="utf-8",m.timeout=120,l.nc&&m.setAttribute("nonce",l.nc),m.src=n(e),c=function(t){m.onerror=m.onload=null,clearTimeout(u);var a=i[e];if(0!==a){if(a){var s=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,r=new Error("Loading chunk "+e+" failed.\n("+s+": "+o+")");r.type=s,r.request=o,a[1](r)}i[e]=void 0}};var u=setTimeout(function(){c({type:"timeout",target:m})},12e4);m.onerror=m.onload=c,document.head.appendChild(m)}return Promise.all(t)},l.m=e,l.c=s,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)l.d(a,s,function(t){return e[t]}.bind(null,s));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],m=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var d=m;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"04ca":function(e,t,a){},"0b4d":function(e,t,a){},"1e81":function(e,t,a){},2252:function(e,t,a){},2463:function(e,t,a){},"291e":function(e,t,a){e.exports=a.p+"img/baikan-movie-3.ecd35231.png"},2948:function(e,t,a){"use strict";var s=a("746e"),o=a.n(s);o.a},"2b8d":function(e,t,a){"use strict";var s=a("35c0"),o=a.n(s);o.a},"33fa":function(e,t,a){"use strict";var s=a("e5ed"),o=a.n(s);o.a},"35c0":function(e,t,a){},"3ff6":function(e,t,a){"use strict";var s=a("bf00"),o=a.n(s);o.a},"40eb":function(e,t,a){"use strict";var s=a("49d8"),o=a.n(s);o.a},"431a":function(e,t,a){},"49d8":function(e,t,a){},5106:function(e,t,a){"use strict";var s=a("ec6f"),o=a.n(s);o.a},"53f6":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);var s=a("795b"),o=a.n(s),i=(a("a481"),a("cadf"),a("551c"),a("f751"),a("097d"),a("2b0e")),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("myNavbar"),a("router-view")],1)},n=[],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("nav",{staticClass:"navbar is-spaced",attrs:{role:"navigation","aria-label":"main navigation"}},[s("div",{staticClass:"navbar-brand"},[s("router-link",{staticClass:"navbar-item",attrs:{to:"/"}},[s("img",{attrs:{src:a("291e"),width:"112",height:"28"}})]),s("a",{staticClass:"navbar-burger burger",class:{"is-active":e.isToggleNav},attrs:{role:"button","aria-label":"menu","aria-expanded":"false"},on:{click:e.toggleNav}},[s("span",{attrs:{"aria-hidden":"true"}}),s("span",{attrs:{"aria-hidden":"true"}}),s("span",{attrs:{"aria-hidden":"true"}})])],1),s("div",{staticClass:"navbar-menu",class:{"is-active":e.isToggleNav}},[s("div",{staticClass:"navbar-start"},[s("router-link",{staticClass:"navbar-item",attrs:{to:"/"}},[s("i",{staticClass:"material-icons"},[e._v("home")]),e._v("\n          首页\n        ")]),s("router-link",{staticClass:"navbar-item",attrs:{to:"/cinema"}},[s("i",{staticClass:"material-icons"},[e._v("local_movies")]),e._v("\n          影讯\n        ")]),s("router-link",{staticClass:"navbar-item",attrs:{to:"/recommend"}},[s("i",{staticClass:"material-icons"},[e._v("pan_tool")]),e._v("\n          猜你想看\n        ")]),s("router-link",{staticClass:"navbar-item",attrs:{to:"/explore"}},[s("i",{staticClass:"material-icons"},[e._v("explore")]),e._v("\n          选电影\n        ")]),s("router-link",{staticClass:"navbar-item",attrs:{to:"/chart"}},[s("i",{staticClass:"material-icons"},[e._v("line_weight")]),e._v("\n          排行榜\n        ")]),s("router-link",{staticClass:"navbar-item",attrs:{to:e.profileUrl}},[s("i",{staticClass:"material-icons"},[e._v("favorite")]),e._v("\n          我的电影\n        ")]),this.$store.state.isLogin&&"User"!==this.$store.state.role?s("router-link",{staticClass:"navbar-item",attrs:{to:"/admin"}},[s("i",{staticClass:"material-icons"},[e._v("build")]),e._v("\n          管理\n        ")]):e._e(),s("div",{staticClass:"navbar-item",attrs:{role:"search box"}},[s("el-select",{staticStyle:{width:"80px"},attrs:{placeholder:"请选择"},model:{value:e.queryCate,callback:function(t){e.queryCate=t},expression:"queryCate"}},e._l(e.options,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),s("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入搜索内容"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.item;return[s("img",{staticStyle:{"max-width":"30px"},attrs:{src:a.image}}),e._v("  \n              "),s("span",{staticClass:"addr"},[e._v(e._s(a.value))])]}}]),model:{value:e.state4,callback:function(t){e.state4=t},expression:"state4"}})],1)],1),s("div",{staticClass:"navbar-end"},[this.$store.state.isLogin?e._e():s("div",{staticClass:"navbar-item"},[s("div",{staticClass:"buttons"},[s("router-link",{staticClass:"button is-primary",attrs:{to:"/sign"}},[s("strong",[e._v("注册")])]),s("router-link",{staticClass:"button is-light",attrs:{to:"/login"}},[e._v("登陆")])],1)]),this.$store.state.isLogin?s("div",{staticClass:"navbar-item",attrs:{role:"message buttom"}},[s("el-badge",{staticClass:"item",attrs:{value:this.$store.state.messageCount,max:99}},[s("router-link",{attrs:{to:"/notification"}},[s("i",{staticClass:"material-icons"},[e._v("message")])])],1)],1):e._e(),s("div",{staticClass:"navbar-item"}),this.$store.state.isLogin?s("div",{staticClass:"navbar-item has-dropdown is-hoverable account"},[s("router-link",{staticClass:"navbar-link",attrs:{to:"/setting"}},[s("i",{staticClass:"material-icons"},[e._v("account_circle")])]),s("div",{staticClass:"navbar-dropdown is-boxed"},[s("router-link",{staticClass:"navbar-item",attrs:{to:"/setting"}},[e._v("账号管理")]),s("hr",{staticClass:"navbar-divider"}),s("a",{staticClass:"navbar-item",on:{click:e.logout}},[e._v("注销登录")])],1)],1):e._e(),s("div",{staticClass:"navbar-item"})])])])])},c=[],m=(a("7f7f"),{data:function(){return{isLogin:!1,isToggleNav:!1,state4:"",queryCate:"movie",options:[{value:"movie",label:"电影"},{value:"people",label:"用户"},{value:"celebrity",label:"演员"}],username:localStorage.getItem("username")}},computed:{profileUrl:function(){return"/people/"+this.$store.state.username}},methods:{getMessageCount:function(){var e=this;this.$http.get("/notification/new_count").then(function(t){e.$store.commit("changeMessageCount",t.data.data.count),setTimeout(function(){e.$store.state.isLogin&&e.getMessageCount()},5e3)}).catch(function(e){console.log("get message count error.")})},toggleNav:function(){this.isToggleNav=!this.isToggleNav},querySearchAsync:function(e,t){var a=this;this.$http.get("/search",{params:{cate:this.queryCate,q:e,page:1,per_page:50}}).then(function(e){var s=[];if("movie"===a.queryCate)for(var o=0;o<e.data.data.items.length;o++)s.push({value:e.data.data.items[o].title,id:e.data.data.items[o].id,image:e.data.data.items[o].image_url});else if("celebrity"===a.queryCate)for(o=0;o<e.data.data.items.length;o++)s.push({value:e.data.data.items[o].name,id:e.data.data.items[o].id,image:e.data.data.items[o].avatar_url});else for(o=0;o<e.data.data.items.length;o++)s.push({value:e.data.data.items[o].username,id:e.data.data.items[o].username,image:e.data.data.items[o].avatar_image});t(s)}).catch(function(e){console.log(e)})},handleSelect:function(e){"movie"===this.queryCate?this.$router.push("/movie/"+e.id):"people"===this.queryCate?this.$router.push("/people/"+e.value):this.$router.push("/celebrity/"+e.id)},logout:function(){localStorage.removeItem("isLogin"),localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("username"),this.$router.push("/login"),this.$store.commit("changeLogin",!1)}},mounted:function(){this.isLogin=this.$store.state.isLogin,console.log(11),this.isLogin&&this.getMessageCount()}}),u=m,d=(a("6f7c"),a("2877")),p=Object(d["a"])(u,l,c,!1,null,null,null),f=p.exports,v={name:"navbar",components:{myNavbar:f}},h=v,g=Object(d["a"])(h,r,n,!1,null,null,null),b=g.exports,_=a("8c4f"),y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._m(0),a("div",{staticClass:"feed-content"},[a("hr"),a("followFeed")],1)])},F=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"head"},[a("span",{staticClass:"title"},[e._v("你关注的......")])])}],C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},e._l(e.feedData,function(t){return 0!==e.feedData.length?a("div",{staticClass:"feed-card"},[a("el-card",{attrs:{shadow:"hover","body-style":{padding:"0px"}}},[a("div",{staticClass:"user"},[a("router-link",{attrs:{to:"/people/"+t.username}},[a("img",{staticClass:"avatar",attrs:{src:t.user_avatar}})]),a("div",{staticClass:"user-title"},[a("router-link",{attrs:{to:"/people/"+t.username}},[a("span",[e._v(e._s(t.username))])]),e._v(" \n            "),0===t.category?a("span",{staticStyle:{color:"#888"}},[e._v("想看")]):e._e(),1===t.category?a("span",{staticStyle:{color:"#888"}},[e._v("在看")]):e._e(),2===t.category?a("span",{staticStyle:{color:"#888"}},[e._v("看过")]):e._e(),a("span",{staticClass:"feed-time"},[e._v(e._s(t.when.replace("T"," ")))]),a("el-rate",{staticClass:"rate",attrs:{disabled:"",colors:["#8888"]},model:{value:t.score/2,callback:function(a){e.$set(t,"score / 2",a)},expression:"feed.score / 2"}})],1)],1),a("div",{staticClass:"feed-movie"},[a("div",[a("router-link",{attrs:{to:"/movie/"+t.movie.id}},[a("span",[e._v(e._s(t.movie.title))])]),e._v(" \n            "),a("span",{staticStyle:{color:"#888"}},[e._v("("+e._s(t.movie.year)+")")]),a("el-rate",{staticClass:"rate",attrs:{disabled:""},model:{value:t.movie.score/2,callback:function(a){e.$set(t.movie,"score / 2",a)},expression:"feed.movie.score / 2"}}),a("span",{staticClass:"score"},[e._v(e._s(t.movie.score))]),a("br")],1),a("br"),a("div",{staticClass:"movie-img"},[a("router-link",{attrs:{to:"/movie/"+t.movie.id}},[a("img",{attrs:{src:t.movie.image_url}})])],1),t.movie.summary?a("span",[e._v(e._s(t.movie.summary.slice(0,70)+"..."))]):e._e(),a("div",{staticClass:"movie-info"},[a("span",{staticClass:"p1"},[e._v("导演:")]),e._l(t.movie.directors,function(t){return a("span",{staticClass:"attrs"},[a("router-link",{attrs:{to:"/celebrity/"+t.id}},[e._v(e._s(t.name))])],1)}),a("br"),a("span",{staticClass:"p1"},[e._v("主演:")]),e._l(t.movie.celebrities,function(t){return a("span",{staticClass:"attrs"},[a("router-link",{attrs:{to:"/celebrity/"+t.id}},[e._v(e._s(t.name))]),e._v("/\n            ")],1)}),a("br"),a("span",{staticClass:"p1"},[e._v("类型:")]),e._l(t.movie.genres,function(t){return a("span",{staticClass:"attrs"},[e._v(e._s(t.genre_name)+"/")])}),a("br")],2)])]),a("br")],1):e._e()}),0),e.next?a("div",{staticClass:"load-more",on:{click:function(t){return e.fetchFeed(e.next)}}},[e._v("\n    加载更多\n  ")]):e._e()])},w=[],x={data:function(){return{feedData:[],next:"",loading:!0}},methods:{fetchFeed:function(e){var t=this;if(e)var a=e;else a="/movie/feed";this.loading=!0,this.$http.get(a).then(function(e){t.feedData=t.feedData.concat(e.data.data.items),t.next=e.data.data.next,t.loading=!1}).catch(function(e){console.log("feed feed error"),t.loading=!1})}},created:function(){this.fetchFeed()}},$=x,k=(a("60fd"),Object(d["a"])($,C,w,!1,null,null,null)),M=k.exports,P={components:{followFeed:M},data:function(){return{}},mounted:function(){}},E=P,I=(a("de16"),Object(d["a"])(E,y,F,!1,null,null,null)),S=I.exports,T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{},[a("div",{staticClass:"title"},[a("H1",[e._v("Page Not Found")])],1)])])},N=[],D={data:function(){return{loged:!0}}},R=D,O=(a("b2b1"),Object(d["a"])(R,T,N,!1,null,null,null)),j=O.exports,q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("mySignForm",{staticClass:"signform"})],1)},A=[],L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{role:"sign form"}},[a("el-form",{ref:"signForm",attrs:{model:e.signForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{type:"string",autocomplete:"off"},model:{value:e.signForm.username,callback:function(t){e.$set(e.signForm,"username",t)},expression:"signForm.username"}})],1),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{type:"email",autocomplete:"off"},model:{value:e.signForm.email,callback:function(t){e.$set(e.signForm,"email",t)},expression:"signForm.email"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"pass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.signForm.pass,callback:function(t){e.$set(e.signForm,"pass",t)},expression:"signForm.pass"}})],1),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.signForm.checkPass,callback:function(t){e.$set(e.signForm,"checkPass",t)},expression:"signForm.checkPass"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("signForm")}}},[e._v("注册")]),a("el-button",{on:{click:function(t){return e.resetForm("signForm")}}},[e._v("重置")])],1)],1)],1)},U=[],z=(a("3022"),{data:function(){var e=this,t=function(t,a,s){if(!a)return s(new Error("用户名不能为空"));var o=/^[a-zA-Z0-9\_]{6,16}$/,i=o.exec(a);if(!i)return s(new Error("用户名不符合要求"));e.$http.get("/user/test/username",{params:{value:a}}).then(function(e){s(new Error("用户名已存在"))}).catch(function(e){s()})},a=function(t,a,s){a||s(new Error("请输入邮箱"));var o=/[^@]+@[^@]+\.[^@]+/,i=o.exec(a);if(!i)return s(new Error("邮箱不符合要求"));e.$http.get("/user/test/email",{params:{value:a}}).then(function(e){s(new Error("邮箱已被注册"))}).catch(function(e){s()})},s=function(t,a,s){""===a&&s(new Error("请输入密码"));var o=/^[0-9a-zA-Z\_\.\!\@\#\$\%\^\&\*]{6,20}$/,i=o.exec(a);if(!i)return s(new Error("密码不符合要求"));""!==e.signForm.checkPass&&e.$refs.signForm.validateField("checkPass"),s()},o=function(t,a,s){""===a&&s(new Error("请再次输入密码"));var o=/^[0-9a-zA-Z\_\.\!\@\#\$\%\^\&\*]{6,20}$/,i=o.exec(a);if(!i)return s(new Error("密码不符合要求"));a!==e.signForm.pass?s(new Error("两次输入密码不一致")):s()};return{signForm:{username:"",email:"",pass:"",checkPass:""},rules:{username:[{validator:t,trigger:"blur"}],email:[{validator:a,trigger:"blur"}],pass:[{validator:s,trigger:"blur"}],checkPass:[{validator:o,trigger:"blur"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit"),!1;t.registerUser(t.signForm.username,t.signForm.email,t.signForm.pass)})},resetForm:function(e){this.$refs[e].resetFields()},registerUser:function(e,t,a){var s=this,o=new URLSearchParams;o.append("username",e),o.append("email",t),o.append("password",a),this.$http.post("/users",o).then(function(e){console.log("ok"),s.showSucceedMess(e.data.username)}).catch(function(e){console.log("failed,"),s.showFailedMess()})},showSucceedMess:function(e){this.$message({showClose:!0,message:e+" ，注册成功,请检查邮箱确认账户!",type:"success"})},showFailedMess:function(){this.$message({howClose:!0,message:"注册失败, 请重试!",type:"error"})}}}),B=z,V=Object(d["a"])(B,L,U,!1,null,null,null),J=V.exports,G={name:"signform",components:{mySignForm:J}},Z=G,H=(a("d024"),Object(d["a"])(Z,q,A,!1,null,null,null)),Y=H.exports,Q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("myLoginForm",{staticClass:"loginform"})],1)},K=[],W=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{role:"login form"}},[a("el-form",{ref:"loginForm",attrs:{model:e.loginForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{type:"string",autocomplete:"off"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"pass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitForm("loginForm")}},model:{value:e.loginForm.pass,callback:function(t){e.$set(e.loginForm,"pass",t)},expression:"loginForm.pass"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",disabled:e.disableLogin},on:{click:function(t){return e.submitForm("loginForm")}}},[e._v("登陆")]),a("el-button",{on:{click:function(t){return e.resetForm("loginForm")}}},[e._v("重置")]),a("router-link",{staticClass:"forget-password",attrs:{to:"/auth/forget-password"}},[e._v("忘记密码?")])],1)],1),a("el-dialog",{attrs:{title:"重新发送确认邮件",visible:e.ratingFormVisible},on:{"update:visible":function(t){e.ratingFormVisible=t}}},[a("resentConfirmEmail")],1)],1)},X=[],ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{role:"login form"}},[a("el-form",{ref:"loginForm",staticClass:"sentemailform",attrs:{model:e.loginForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{type:"string",autocomplete:"off"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"pass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.loginForm.pass,callback:function(t){e.$set(e.loginForm,"pass",t)},expression:"loginForm.pass"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("loginForm")}}},[e._v("发送确认邮件")]),a("el-button",{on:{click:function(t){return e.resetForm("loginForm")}}},[e._v("重置")])],1)],1)],1)},te=[],ae={data:function(){var e=this,t=function(t,a,s){if(!a)return s(new Error("用户名不能为空"));var o=/^[a-zA-Z0-9\_]{6,16}$/,i=o.exec(a);if(!i)return s(new Error("用户名不符合要求"));e.$http.get("/user/validate",{params:{type_name:"username",value:a}}).then(function(e){s(new Error("用户不存在"))}).catch(function(e){s()})},a=function(e,t,a){""===t&&a(new Error("请输入密码"));var s=/^[0-9a-zA-Z\_\.\!\@\#\$\%\^\&\*]{6,20}$/,o=s.exec(t);if(!o)return a(new Error("密码不符合要求"));a()};return{loginForm:{username:"",pass:""},rules:{username:[{validator:t,trigger:"blur"}],pass:[{validator:a,trigger:"blur"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit"),!1;console.log("OK"),t.sentEmail(t.loginForm.username,t.loginForm.pass)})},resetForm:function(e){this.$refs[e].resetFields()},sentEmail:function(e,t){var a=this,s=new URLSearchParams;s.append("grant_type","password"),s.append("username",e),s.append("password",t),this.$http.post("/auth/resent-confirm",s).then(function(e){a.showSucceedMess(e.data.message)}).catch(function(e){a.showFailedMess(e.response.data.message)})},showSucceedMess:function(e){this.$message({showClose:!0,message:e,type:"success"})},showFailedMess:function(e){this.$message({howClose:!0,message:e,type:"error"})}}},se=ae,oe=(a("c9b7"),Object(d["a"])(se,ee,te,!1,null,null,null)),ie=oe.exports,re={components:{resentConfirmEmail:ie},data:function(){var e=this,t=function(t,a,s){if(!a)return s(new Error("用户名不能为空"));var o=/^[a-zA-Z0-9\_]{6,16}$/,i=o.exec(a);if(!i)return s(new Error("用户名不符合要求"));e.$http.get("/user/test/username",{params:{value:a}}).then(function(e){s()}).catch(function(e){s(new Error("用户不存在"))})},a=function(e,t,a){""===t&&a(new Error("请输入密码"));var s=/^[0-9a-zA-Z\_\.\!\@\#\$\%\^\&\*]{6,20}$/,o=s.exec(t);if(!o)return a(new Error("密码不符合要求"));a()};return{loginForm:{username:"test_one",pass:"123456"},rules:{username:[{validator:t,trigger:"blur"}],pass:[{validator:a,trigger:"blur"}]},errorCount:0,disableLogin:!1,ratingFormVisible:!1}},methods:{submitForm:function(e){var t=this;if(this.disableLogin)return!1;this.$refs[e].validate(function(e){if(!e)return console.log("error submit"),!1;console.log("OK"),t.loginPost(t.loginForm.username,t.loginForm.pass)})},resetForm:function(e){this.$refs[e].resetFields()},loginPost:function(e,t){var a=this,s=new URLSearchParams;s.append("grant_type","password"),s.append("username",e),s.append("password",t),this.$http.post("/token",s).then(function(t){a.showSucceedMess(a.loginForm.username),a.$store.commit("changeLogin",!0),a.$store.commit("setUsername",e),a.$store.commit("setToken",t.data.access_token),a.$store.commit("setRole",t.data.role),a.$http.defaults.headers.common["Authorization"]="bearer "+t.data.access_token,a.$router.push("/")}).catch(function(e){a.errorCount=a.errorCount+1,1e3===e.response.data.error_code&&3===a.errorCount?(a.$message.info("未收到确认邮件?"),a.ratingFormVisible=!0):(5===a.errorCount&&(a.disableLogin=!0,a.showFailedMess("错误次数太多,请稍后再试!")),a.showFailedMess(e.response.data.message))})},showSucceedMess:function(e){this.$message({showClose:!0,message:e+" ，登陆成功!",type:"success"})},showFailedMess:function(e){this.$message({showClose:!0,message:e,type:"error"})}}},ne=re,le=(a("3ff6"),Object(d["a"])(ne,W,X,!1,null,null,null)),ce=le.exports,me={components:{myLoginForm:ce}},ue=me,de=(a("d6db"),Object(d["a"])(ue,Q,K,!1,null,null,null)),pe=de.exports,fe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("movieDetail",{attrs:{movieDetail:e.movieInfo,me2movie:e.me2movie}})},ve=[],he=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:this.$store.state.movieDetailLoading,expression:"this.$store.state.movieDetailLoading"}],staticClass:"container-moving"},[a("div",{staticClass:"content"},[a("h1",[a("span",{staticClass:"title"},[e._v(e._s(e.movieDetail.title))]),a("span",{staticClass:"year"},[e._v("("+e._s(e.movieDetail.year)+")")])]),a("div",{staticClass:"detail clearfix"},[a("div",{staticClass:"left-side"},[a("div",{staticClass:"actor-list"},[a("div",{staticClass:"subject"},[a("div",{staticClass:"mainpic"},[a("img",{staticClass:"movieImg",attrs:{src:e.movieDetail.image_url,alt:""}})]),a("div",{staticClass:"info"},[a("span",{staticClass:"p1"},[e._v("导演:")]),e._l(e.movieDetail.directors,function(t){return a("span",{staticClass:"attrs"},[a("router-link",{attrs:{to:"/celebrity/"+t.id}},[e._v(e._s(t.name))]),e._v("/\n              ")],1)}),a("br"),a("span",{staticClass:"p1"},[e._v("主演:")]),e._l(e.movieDetail.celebrities,function(t){return a("span",{staticClass:"attrs"},[a("router-link",{attrs:{to:"/celebrity/"+t.id}},[e._v(e._s(t.name))]),e._v("/\n              ")],1)}),a("br"),a("span",{staticClass:"p1"},[e._v("类型:")]),e._l(e.movieDetail.genres,function(t){return a("span",{staticClass:"attrs"},[e._v(e._s(t.genre_name)+"/")])}),a("br"),a("span",{staticClass:"p1"},[e._v("制片国家/地区:")]),e._l(e.movieDetail.countries,function(t,s){return a("span",{staticClass:"attrs"},[e._v(e._s(t.country_name)+"/")])}),a("br"),a("span",{staticClass:"p1"},[e._v("又名:")]),e._l(e.movieDetail.aka_list,function(t){return a("span",{staticClass:"attrs"},[e._v(e._s(t)+" ")])}),a("br"),e.movieDetail.seasons_count?a("span",{staticClass:"p1"},[e._v("总季数:")]):e._e(),e.movieDetail.seasons_count?a("span",[e._v(e._s(e.movieDetail.seasons_count))]):e._e(),e.movieDetail.seasons_count?a("br"):e._e(),e.movieDetail.episodes_count?a("span",{staticClass:"p1"},[e._v("集数:")]):e._e(),e.movieDetail.episodes_count?a("span",[e._v(e._s(e.movieDetail.episodes_count))]):e._e(),e.movieDetail.episodes_count?a("br"):e._e(),e.movieDetail.current_season?a("span",{staticClass:"p1"},[e._v("季数:")]):e._e(),e.movieDetail.current_season?a("span",[e._v(e._s(e.movieDetail.current_season))]):e._e(),e.movieDetail.current_season?a("br"):e._e(),e.movieDetail.douban_id?a("span",{staticClass:"p1"},[e._v("豆瓣链接:")]):e._e(),a("span",[a("a",{attrs:{href:"https://movie.douban.com/subject/"+e.movieDetail.douban_id,target:"_blank"}},[e._v(e._s(e.movieDetail.douban_id))])]),e.movieDetail.douban_id?a("br"):e._e()],2)]),a("div",{staticClass:"people-sroce"},[a("div",[a("p",[e._v("豆瓣评分")]),e.movieDetail.score/2?a("span",{staticClass:"score"},[e._v(e._s(e.movieDetail.score))]):e._e(),a("el-rate",{attrs:{disabled:"","text-color":"#ff9900"},model:{value:e.movieDetail.score/2,callback:function(t){e.$set(e.movieDetail,"score / 2",t)},expression:"movieDetail.score / 2"}}),e.movieDetail.score?a("p",{staticClass:"comment-num"},[e._v("\n                "+e._s(e.movieDetail.rating_count)+"人评价\n              ")]):e._e()],1)]),a("div",["User"!==this.$store.state.role?a("el-button",{attrs:{type:"danger"},on:{click:e.deleteMovieConfirm}},[e._v("删除这个电影")]):e._e()],1),a("div",[a("router-link",{attrs:{to:"/movie/"+this.movieDetail.id+"/update"}},["User"!==this.$store.state.role?a("el-button",{attrs:{type:"warning"}},[e._v("修改电影信息")]):e._e()],1)],1)]),a("div",{staticClass:"insterest-people"},[null===e.me2movie?a("div",{staticClass:"top"},[a("a",{on:{click:function(t){return e.wishRating()}}},[a("button",[e._v("想看")])]),"tv"===e.movieDetail.subtype?a("a",{on:{click:function(t){return e.doRating()}}},[a("button",[e._v("在看")])]):e._e(),a("a",{on:{click:function(t){return e.collectRating()}}},[a("button",[e._v("看过")])]),a("span",{staticClass:"score-to"},[e._v("\n              评价:\n              "),a("el-rate",{attrs:{"show-text":"",texts:["很差","较差","还行","推荐","力荐"],colors:["#99A9BF","#F7BA2A","#FF9900"]},on:{change:e.collectRating},model:{value:e.score,callback:function(t){e.score=t},expression:"score"}})],1)]):e._e(),null!==e.me2movie?a("div",{staticClass:"top"},[2===e.me2movie.cate?a("span",{staticClass:"stitle"},[e._v("\n              我\n              "),a("small",[e._v(e._s(e.me2movie.time))]),e._v(" 看过\n            ")]):e._e(),1===e.me2movie.cate?a("span",{staticClass:"stitle"},[e._v("\n              我\n              "),a("small",[e._v(e._s(e.me2movie.time))]),e._v(" 在看\n            ")]):e._e(),0===e.me2movie.cate?a("span",{staticClass:"stitle"},[e._v("\n              我\n              "),a("small",[e._v(e._s(e.me2movie.time))]),e._v(" 想看\n            ")]):e._e(),a("br"),a("span",{staticClass:"score-to"},[e._v("\n              我的评价:\n              "),a("el-rate",{attrs:{disabled:"","text-color":"#ff9900","score-template":"{value}"},model:{value:e.me2movie.score/2,callback:function(t){e.$set(e.me2movie,"score / 2",t)},expression:"me2movie.score / 2"}})],1),a("a",{on:{click:function(t){return e.deleteRating()}}},[e._v("删除")]),a("br"),"[]"!==JSON.stringify(e.me2movie.tags)?a("span",[e._v("\n              标签:\n              "),e._l(e.me2movie.tags,function(t){return a("small",[e._v(e._s(t+" "))])})],2):e._e(),a("br"),e.me2movie.comment?a("span",[e._v("\n              评价:\n              "),a("small",[e._v(e._s(e.me2movie.comment))])]):e._e()]):e._e()]),a("div",{staticClass:"gtleft"}),a("div",{staticClass:"summary"},[a("p",{staticClass:"summary-title"},[e._v("\n            "+e._s(e.movieDetail.title)+" 的剧情简介 · · · · · ·\n          ")]),a("p",{staticClass:"intro"},[e._v("\n                   "+e._s(e.movieDetail.summary)+"\n          ")])]),a("movieComment",{attrs:{movieId:this.movieDetail.id,title:e.movieDetail.title}})],1)])]),a("el-dialog",{attrs:{title:"评价",visible:e.ratingFormVisible},on:{"update:visible":function(t){e.ratingFormVisible=t}}},[e._v("\n    评分:\n    "),a("el-rate",{attrs:{"show-text":"",texts:["很差","较差","还行","推荐","力荐"],colors:["#99A9BF","#F7BA2A","#FF9900"]},model:{value:e.score,callback:function(t){e.score=t},expression:"score"}}),a("br"),e._v("标签:\n    "),a("br"),a("el-input",{attrs:{placeholder:"多个标签用空格分隔",type:"text"},model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}}),e._v("\n    评论:\n    "),a("br"),a("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入评论 ·  ·  · "},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.cancelRating()}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.rating}},[e._v("确 定")])],1)],1)],1)},ge=[],be={props:["movieDetail","me2movie"],data:function(){return{ratingFormVisible:!1,score:0,tags:"",comment:"",typeName:"",movieId:this.movieDetail.id}},components:{movieComment:function(e){a.e("chunk-66d754ac").then(function(){var t=[a("2afb")];e.apply(null,t)}.bind(this)).catch(a.oe)}},methods:{deleteMovieConfirm:function(){var e=this;this.$confirm("此操作将永久该电影, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.deleteMovie()}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},deleteMovie:function(){var e=this;this.$http.delete("/movie/"+this.movieDetail.id).then(function(t){e.$message.success("当前电影已被删除")}).catch(function(t){e.$message.error("请稍后再试")})},cancelRating:function(){this.ratingFormVisible=!1},wishRating:function(){this.showRating(),this.typeName=0},doRating:function(){this.showRating(),this.typeName=1},collectRating:function(){this.showRating(),this.typeName=2},showRating:function(){this.ratingFormVisible=!0},rating:function(){var e=this,t=new URLSearchParams,a=this.movieDetail.id;t.append("interest",this.typeName),t.append("score",2*this.score),t.append("tags",this.tags),t.append("comment",this.comment),this.$http.post("/movie/"+a+"/rating",t).then(function(t){e.showSucceedMess("评价成功!"),e.$router.go(0)}).catch(function(t){e.showFailedMess("请稍后再试!")}),this.ratingFormVisible=!1},showSucceedMess:function(e){this.$message({showClose:!0,message:e,type:"success"})},showFailedMess:function(e){this.$message({showClose:!0,message:e,type:"error"})},deleteRating:function(){var e=this;this.$confirm("此操作将永久该评价, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=e.me2movie.id,a="/rating/"+t;e.$http.delete(a).then(function(t){e.showSucceedMess(t.data.message),e.$router.go(0)}).catch(function(t){e.showFailedMess("请稍后再试!")})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})}}},_e=be,ye=(a("9256"),Object(d["a"])(_e,he,ge,!1,null,null,null)),Fe=ye.exports,Ce={props:["movieid"],components:{movieDetail:Fe},data:function(){return{movieInfo:{},me2movie:{}}},watch:{$route:function(e,t){this.fetchMovieInfo()}},mounted:function(){this.fetchMovieInfo()},methods:{fetchMovieInfo:function(){var e=this,t="/movie/"+this.$route.params.movieid;console.log(t),this.$http.get(t).then(function(t){e.movieInfo=t.data.data,e.me2movie=t.data.data.me_to_movie,console.log(e.me2movie)}).catch(function(t){e.$message.error("未找到相关信息"),e.$router.push("/"),console.log("get movie detail error")})}}},we=Ce,xe=Object(d["a"])(we,fe,ve,!1,null,null,null),$e=xe.exports,ke=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div")},Me=[],Pe={mounted:function(){var e=this,t=this.$route.query.token,a=new URLSearchParams;a.append("token",t),this.$http.post("/user/email/token/confirm-email",a).then(function(t){e.showSucceedMess(t.data.message),e.$router.push("/login")}).catch(function(t){e.showErrorMess(t.response.data.message),e.$router.push("/")})},methods:{showSucceedMess:function(e){this.$message({showClose:!0,message:e,type:"success"})},showErrorMess:function(e){this.$message({howClose:!0,message:e,type:"error"})}}},Ee=Pe,Ie=(a("e157"),Object(d["a"])(Ee,ke,Me,!1,null,"70042a8c",null)),Se=Ie.exports,Te=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"resetPasswordEmailForm",attrs:{role:"form for sent reset password email "}},[a("el-form",{ref:"emailForm",attrs:{model:e.resetPasswordEmailForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{type:"email",autocomplete:"off"},model:{value:e.resetPasswordEmailForm.email,callback:function(t){e.$set(e.resetPasswordEmailForm,"email",t)},expression:"resetPasswordEmailForm.email"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("emailForm")}}},[e._v("发送重置链接")]),a("el-button",{on:{click:function(t){return e.resetForm("emailForm")}}},[e._v("清空")])],1)],1)],1)},Ne=[],De={data:function(){var e=this,t=function(t,a,s){a||s(new Error("请输入邮箱"));var o=/[^@]+@[^@]+\.[^@]+/,i=o.exec(a);if(!i)return s(new Error("邮箱不符合要求"));e.$http.get("/user/test/email",{params:{value:a}}).then(function(e){s()}).catch(function(e){s(new Error("邮箱不存在!"))})};return{resetPasswordEmailForm:{email:""},rules:{email:[{validator:t,trigger:"blur"}]}}},methods:{resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit"),!1;var a=new URLSearchParams;a.append("email",t.resetPasswordEmailForm.email),t.$http.put("/user/password",a).then(function(e){t.showSucceedMess(e.data.message)}).catch(function(e){t.showFailedMess("请 "+e.response.data.second+" 秒后再重试！")})})},showSucceedMess:function(e){this.$message({showClose:!0,message:e,type:"success"})},showFailedMess:function(e){this.$message({howClose:!0,message:e,type:"error"})}}},Re=De,Oe=(a("7945"),Object(d["a"])(Re,Te,Ne,!1,null,"4db5f645",null)),je=Oe.exports,qe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"resetPasswordForm",staticClass:"resetPasswordForm",attrs:{model:e.resetPasswordForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"密码",prop:"pass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.resetPasswordForm.pass,callback:function(t){e.$set(e.resetPasswordForm,"pass",t)},expression:"resetPasswordForm.pass"}})],1),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.resetPasswordForm.checkPass,callback:function(t){e.$set(e.resetPasswordForm,"checkPass",t)},expression:"resetPasswordForm.checkPass"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("resetPasswordForm")}}},[e._v("重置密码")]),a("el-button",{on:{click:function(t){return e.resetForm("resetPasswordForm")}}},[e._v("重置")])],1)],1)],1)},Ae=[],Le={data:function(){var e=this,t=function(t,a,s){""===a&&s(new Error("请输入密码"));var o=/^[0-9a-zA-Z\_\.\!\@\#\$\%\^\&\*]{6,20}$/,i=o.exec(a);if(!i)return s(new Error("密码不符合要求"));""!==e.resetPasswordForm.checkPass&&e.$refs.resetPasswordForm.validateField("checkPass"),s()},a=function(t,a,s){""===a&&s(new Error("请再次输入密码"));var o=/^[0-9a-zA-Z\_\.\!\@\#\$\%\^\&\*]{6,20}$/,i=o.exec(a);if(!i)return s(new Error("密码不符合要求"));a!==e.resetPasswordForm.pass?s(new Error("两次输入密码不一致")):s()};return{resetPasswordForm:{pass:"",checkPass:""},rules:{pass:[{validator:t,trigger:"blur"}],checkPass:[{validator:a,trigger:"blur"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit"),!1;var a=t.$route.query.token,s=new URLSearchParams;s.append("password",t.resetPasswordForm.pass),s.append("token",a),t.$http.post("/user/email/token/reset-password",s).then(function(e){t.showSucceedMess(e.data.message),t.$router.push("/login")}).catch(function(e){t.showFailedMess(e.response.data.message)})})},resetForm:function(e){this.$refs[e].resetFields()},showSucceedMess:function(e){this.$message({showClose:!0,message:e,type:"success"})},showFailedMess:function(e){this.$message({howClose:!0,message:e,type:"error"})}}},Ue=Le,ze=(a("33fa"),Object(d["a"])(Ue,qe,Ae,!1,null,"a1131fac",null)),Be=ze.exports,Ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"confirmChangeEmail",attrs:{role:"form for sent reset password email "}},[a("el-form",{ref:"emailForm",attrs:{model:e.confirmChangeEmail,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{type:"email",autocomplete:"off"},model:{value:e.confirmChangeEmail.email,callback:function(t){e.$set(e.confirmChangeEmail,"email",t)},expression:"confirmChangeEmail.email"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("emailForm")}}},[e._v("确认")]),a("el-button",{on:{click:function(t){return e.resetForm("emailForm")}}},[e._v("重置")])],1)],1)],1)},Je=[],Ge={data:function(){var e=this,t=function(t,a,s){a||s(new Error("请输入邮箱"));var o=/[^@]+@[^@]+\.[^@]+/,i=o.exec(a);if(!i)return s(new Error("邮箱不符合要求"));e.$http.get("/user/test/email",{params:{value:a}}).then(function(e){s(new Error("邮箱已占用!"))}).catch(function(e){s()})};return{confirmChangeEmail:{email:""},rules:{email:[{validator:t,trigger:"blur"}]}}},methods:{resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit"),!1;var a=new URLSearchParams,s=t.$route.query.token;a.append("new_email",t.confirmChangeEmail.email),a.append("token",s),t.$http.post("/user/email/token/change-email",a).then(function(e){t.showSucceedMess(e.data.message)}).catch(function(e){t.showFailedMess(e.response.data.message)})})},showSucceedMess:function(e){this.$message({showClose:!0,message:e,type:"success"})},showFailedMess:function(e){this.$message({howClose:!0,message:e,type:"error"})}}},Ze=Ge,He=(a("2b8d"),Object(d["a"])(Ze,Ve,Je,!1,null,"cc2dccd2",null)),Ye=He.exports,Qe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingUserInfo,expression:"loadingUserInfo"}],staticClass:"container-people"},[a("div",{staticClass:"content"},[a("div",{staticClass:"detail clearfix"},[a("div",{staticClass:"left-side"},[a("div",{staticClass:"subject"},[a("div",{staticClass:"mainpic"},[a("a",[a("img",{attrs:{src:e.peopleInfo.avatar_image}})])]),a("h1",[a("span",{staticClass:"username title"},[e._v(e._s(e.peopleInfo.username))])]),a("p",{staticClass:"signature"},[e._v(e._s(e.peopleInfo.signature))])]),e.location?a("div",{staticClass:"location"},[a("i",{staticClass:"material-icons loc-img"},[e._v("location_on")]),a("span",[e._v(e._s(e.location))])]):e._e(),a("div",{staticClass:"friendship"},[e._v("\n          粉丝\n          "),a("router-link",{attrs:{to:"/people/"+e.username+"/follower"}},[e._v("("+e._s(e.followers)+")")]),e._v("    关注\n          "),a("router-link",{attrs:{to:"/people/"+e.username+"/following"}},[e._v("("+e._s(e.peopleInfo.followings_count)+")")]),a("br"),e.followHe||e.loginUser===e.peopleInfo.username?e._e():a("a",{on:{click:e.follow}},[a("button",[e._v("关注")])]),e.followHe&&e.loginUser!==e.peopleInfo.username?a("a",{on:{click:e.unfollow}},[a("button",[e._v("取消关注")])]):e._e()],1),"Administrator"===this.$store.state.role?a("div",{staticClass:"role-set"},[a("el-select",{staticClass:"role-options",attrs:{placeholder:"请选择"},model:{value:e.currentRole,callback:function(t){e.currentRole=t},expression:"currentRole"}},e._l(e.roles,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1),a("el-button",{staticClass:"set-role-button",attrs:{size:"medium"},on:{click:function(t){return e.setRole()}}},[e._v("更改权限")])],1):e._e()])]),a("div",{staticClass:"people-active"},[a("div",{staticClass:"cate"},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"看过("+e.collectCount+")",name:"collect"}},[a("peopleMovieCard",{attrs:{movies:e.collectMovies}}),e.collectNext?a("div",{staticClass:"load-more",on:{click:function(t){return e.fetchMore(e.activeName)}}},[e._v("\n              获取更多\n            ")]):e._e()],1),a("el-tab-pane",{attrs:{label:"在看("+e.doCount+")",name:"do"}},[a("peopleMovieCard",{attrs:{movies:e.doMovies}}),e.doNext?a("div",{staticClass:"load-more",on:{click:function(t){return e.fetchMore(e.activeName)}}},[e._v("\n              获取更多\n            ")]):e._e()],1),a("el-tab-pane",{attrs:{label:"想看("+e.wishCount+")",name:"wish"}},[a("peopleMovieCard",{attrs:{movies:e.wishMovies}}),e.wishNext?a("div",{staticClass:"load-more",on:{click:function(t){return e.fetchMore(e.activeName)}}},[e._v("\n              获取更多\n            ")]):e._e()],1)],1)],1)])])])},Ke=[],We=(a("28a5"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.movies,function(t){return e.movies?a("div",{staticClass:"movie"},[a("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[a("router-link",{attrs:{to:"/movie/"+t.movie.id}},[a("img",{staticClass:"image",attrs:{src:t.movie.image_url}}),a("div",{staticClass:"content"},[a("span",{staticClass:"movie-title"},[e._v(e._s(t.movie.title))]),a("span",{staticClass:"movie-year"},[e._v(e._s(t.movie.year))]),a("br"),a("br"),a("el-rate",{attrs:{disabled:"","text-color":"#ff9900","score-template":"{value}"},model:{value:t.score/2,callback:function(a){e.$set(t,"score / 2",a)},expression:"movie.score / 2"}}),0!==t.tags.length?a("span",[e._v("\n            标签:  \n            "),e._l(t.tags,function(t){return a("small",[e._v(e._s(t+" "))])})],2):e._e(),a("br"),t.comment?a("span",[e._v("\n            评价:  \n            "),a("small",[e._v(e._s(t.comment))])]):e._e(),a("br"),a("small",{staticClass:"time"},[e._v(e._s(t.when.replace("T"," ")))])],1)])],1),a("br")],1):e._e()}),0)}),Xe=[],et={props:["movies"]},tt=et,at=(a("e28c"),Object(d["a"])(tt,We,Xe,!1,null,null,null)),st=at.exports,ot=a("ef6c"),it={components:{peopleMovieCard:st},props:["username"],data:function(){return{loginUser:localStorage.getItem("username"),peopleInfo:{},loadingUserInfo:!0,followHe:!1,followers:0,signature:"",activeName:"collect",collectMovies:[],collectNext:"",collectCount:0,doMovies:[],doNext:"",doCount:0,wishMovies:[],wishNext:"",wishCount:0,codeToText:ot["CodeToText"],location:"",currentRole:"",roles:[]}},watch:{$route:function(e,t){this.username=this.$route.params.username,this.collectMovies=[],this.wishMovies=[],this.doMovies=[],this.fetchUserInfo(),this.fetchMovie("collect"),this.fetchMovie("wish"),this.fetchMovie("do"),console.log(this.$store.state.role),"Administrator"===this.$store.state.role&&(this.getCurrentRole(),this.getAllRole())}},methods:{getCurrentRole:function(){var e=this;this.$http.get("/users/"+this.username+"/role").then(function(t){e.currentRole=t.data.role_name}).catch(function(e){console.log("get current role error")})},getAllRole:function(){var e=this;this.$http.get("/role").then(function(t){e.roles=t.data.data.roles}).catch(function(e){console.log("get all role info error")})},setRole:function(){var e=this,t=new URLSearchParams;t.append("role_name",this.currentRole),this.$http.put("/users/"+this.username+"/role",t).then(function(t){e.$message.success("设置用户权限成功")}).catch(function(t){e.$message.error("设置用户权限失败")})},fetchMore:function(e){"do"===e&&this.fetchMovie("-1",this.doNext),"wish"===e&&this.fetchMovie("-1",this.wishNext),"collect"===e&&this.fetchMovie("-1",this.collectNext)},handleClick:function(e,t){"do"===e.name?0===this.doMovies.length&&this.fetchMovie(e.name):"wish"===e.name?0===this.wishMovies.length&&this.fetchMovie(e.name):"collect"===e.name&&0===this.collectMovies.length&&this.fetchMovie(e.name)},fetchMovie:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-1";if("-1"===a){a="/users/"+this.username+"/movie";var s={type_name:t}}else{t=a.split("type_name")[1].split("=")[1].split("&")[0];s={}}this.$http.get(a,{params:s}).then(function(a){"wish"===t?(e.wishNext=a.data.data.next,e.wishMovies=e.wishMovies.concat(a.data.data.items),e.wishCount=a.data.data.total):"do"===t?(e.doNext=a.data.data.next,e.doMovies=e.doMovies.concat(a.data.data.items),e.doCount=a.data.data.total):"collect"===t&&(e.collectNext=a.data.data.next,e.collectMovies=e.collectMovies.concat(a.data.data.items),e.collectCount=a.data.data.total)}).catch(function(t){console.log("fetch movie error."),console.log(e.collectMovies)})},follow:function(){var e=this,t="/users/"+this.username+"/follow";this.$http.post(t).then(function(t){e.followHe=!0,e.followers=e.followers+1,e.showSucceedMess("关注成功","success")}).catch(function(t){e.showSucceedMess("关注失败","error")})},unfollow:function(){var e=this,t="/users/"+this.username+"/unfollow";new URLSearchParams;this.$http.delete(t).then(function(t){e.followHe=!1,e.followers=e.followers-1,e.showSucceedMess("取消关注成功","success")}).catch(function(t){e.showSucceedMess("取消失败","error")})},showSucceedMess:function(e,t){this.$message({showClose:!0,message:e,type:t})},fetchUserInfo:function(){var e=this,t="/users/"+this.$route.params.username;this.$http.get(t).then(function(t){e.peopleInfo=t.data.data,t.data.data.city_name&&(e.location=t.data.data.city_name),e.followHe=t.data.follow,e.followers=t.data.data.followers_count,console.log(t.data.followers_count),console.log(e.followers),e.signature=t.data.data.signature,e.loadingUserInfo=!1}).catch(function(t){console.log("get user detail error"),e.loadingUserInfo=!1,e.$router.push("/"),e.$message.error("未找到相关信息"),e.loadingUserInfo=!1,e.error=!0})}},created:function(){this.fetchUserInfo(),this.fetchMovie("collect"),this.fetchMovie("wish"),this.fetchMovie("do"),"Administrator"===this.$store.state.role&&(this.getCurrentRole(),this.getAllRole())}},rt=it,nt=(a("f2ff"),Object(d["a"])(rt,Qe,Ke,!1,null,"9519757e",null)),lt=nt.exports,ct=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("celebrityDetail",{attrs:{celeInfo:e.info,loadingInfo:e.loading}})},mt=[],ut=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingInfo,expression:"loadingInfo"}],staticClass:"container-moving"},[a("div",{staticClass:"content"},[a("h1",[a("span",{staticClass:"title"},[e._v(e._s(e.celebrityInfo.name))])]),a("div",{staticClass:"detail clearfix"},[a("div",{staticClass:"left-side"},[a("div",{staticClass:"actor-list"},[a("div",{staticClass:"subject"},[a("div",{staticClass:"mainpic"},[a("img",{staticClass:"movieImg",attrs:{src:e.celebrityInfo.avatar_url,alt:""}})]),a("div",{staticClass:"info"},[0===e.celebrityInfo.gender?a("span",{staticClass:"p1"},[e._v("性别: 男")]):e._e(),1===e.celebrityInfo.gender?a("span",{staticClass:"p1"},[e._v("性别: 女")]):e._e(),null!==e.celebrityInfo.gender?a("br"):e._e(),e.celebrityInfo.born_place?a("span",{staticClass:"p1"},[e._v("出生地:")]):e._e(),a("span",{staticClass:"attrs"},[e._v(e._s(e.celebrityInfo.born_place))]),e.celebrityInfo.born_place?a("br"):e._e(),e.celebrityInfo.name_en?a("span",{staticClass:"p1"},[e._v("英文名:")]):e._e(),a("span",{staticClass:"attrs"},[e._v(e._s(e.celebrityInfo.name_en))]),e.celebrityInfo.name_en?a("br"):e._e(),"[]"!==JSON.stringify(e.celebrityInfo.aka_en_list)?a("span",{staticClass:"p1"},[e._v("更多外文名:")]):e._e(),e._l(e.celebrityInfo.aka_en_list,function(t){return a("span",{staticClass:"attrs"},[e._v(e._s(t)+" /")])}),"[]"!==JSON.stringify(e.celebrityInfo.aka_list)?a("br"):e._e(),"[]"!==JSON.stringify(e.celebrityInfo.aka_list)?a("span",{staticClass:"p1"},[e._v("更多中文名:")]):e._e(),e._l(e.celebrityInfo.aka_list,function(t){return a("span",{staticClass:"attrs"},[e._v(e._s(t)+" /")])}),"[]"!==JSON.stringify(e.celebrityInfo.aka)?a("br"):e._e(),e.celebrityInfo.douban_id?a("span",{staticClass:"p1"},[e._v("豆瓣链接:")]):e._e(),a("span",[a("a",{attrs:{href:"https://movie.douban.com/celebrity/"+e.celebrityInfo.douban_id,target:"_blank"}},[e._v(e._s(e.celebrityInfo.douban_id))])]),e.celebrityInfo.douban_id?a("br"):e._e()],2)]),a("div",["user"!==this.$store.state.role?a("el-button",{attrs:{type:"danger"},on:{click:e.deleteCelebrityConfirm}},[e._v("删除这个影人")]):e._e()],1),a("div",[a("router-link",{attrs:{to:"/celebrity/"+this.celebrityInfo.id+"/update"}},["User"!==this.$store.state.role?a("el-button",{attrs:{type:"warning"}},[e._v("修改影人信息")]):e._e()],1)],1)])])]),a("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"ta导演的",name:"direct"}},[a("movieList",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingInfo,expression:"loadingInfo"}],attrs:{movies:e.direct_movies}}),a("hr"),e.directNext?a("div",{staticClass:"load-more",on:{click:e.loadMoreD}},[e._v("加载更多")]):e._e()],1),a("el-tab-pane",{attrs:{label:"ta参演的",name:"cast"}},[a("movieList",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingInfo,expression:"loadingInfo"}],attrs:{movies:e.casts_movies}}),a("hr"),e.castNext?a("div",{staticClass:"load-more",on:{click:e.loadMoreC}},[e._v("加载更多")]):e._e()],1)],1)],1)])},dt=[],pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"moviesList"},[a("div",{staticClass:"movie-container"},e._l(e.movies,function(t){return a("div",{staticClass:"movieTag"},[a("ul",[a("li",{staticClass:"film-pic"},[a("router-link",{attrs:{to:"/movie/"+t.id}},[a("img",{staticClass:"movieImg",attrs:{src:t.image_url,alt:""}})])],1),a("li",{staticClass:"film-name"},[a("router-link",{attrs:{to:"/movie/"+t.id}},[e._v(e._s(t.title))])],1),a("li",{staticClass:"film-rate"},[a("el-rate",{attrs:{disabled:"","text-color":"#ff9900"},model:{value:t.score/2,callback:function(a){e.$set(t,"score / 2",a)},expression:"movie.score / 2"}})],1),a("li",{staticClass:"film-button"})])])}),0)])},ft=[],vt={props:{movies:Array},methods:{}},ht=vt,gt=Object(d["a"])(ht,pt,ft,!1,null,null,null),bt=gt.exports,_t={components:{movieList:bt},props:["celeInfo","loadingInfo"],data:function(){return{celebrityInfo:this.celeInfo,activeName:"direct",direct_movies:[],casts_movies:[],directNext:"",castNext:""}},watch:{celeInfo:function(e,t){this.celebrityInfo=e},celebrityInfo:function(e,t){this.celebrityId=e.id,this.fetchCelebrityMovies("director"),this.fetchCelebrityMovies("celebrity")}},methods:{fetchCelebrityMovies:function(e){var t=this,a="/celebrity/"+this.celebrityId+"/movie";this.$http.get(a,{params:{cate:e}}).then(function(a){"director"===e?(t.direct_movies=a.data.data.items,t.directNext=a.data.data.next):(t.casts_movies=a.data.data.items,t.castNext=a.data.data.next),t.loading=!1}).catch(function(e){t.loading=!1})},deleteCelebrityConfirm:function(){var e=this;this.$confirm("此操作将永久该影人, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.deleteCelebrity()}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},deleteCelebrity:function(){var e=this;this.$http.delete("/celebrity/"+this.celebrityInfo.id).then(function(t){e.$message.success("当前影人信息已被删除")}).catch(function(t){e.$message.error("请稍后再试")})}}},yt=_t,Ft=(a("650c"),Object(d["a"])(yt,ut,dt,!1,null,null,null)),Ct=Ft.exports,wt={props:["celebrityid"],components:{celebrityDetail:Ct},data:function(){return{loading:!0,info:{}}},watch:{$route:function(e,t){this.fetchCelebrityInfo()}},mounted:function(){this.fetchCelebrityInfo()},methods:{fetchCelebrityInfo:function(){var e=this,t="/celebrity/"+this.celebrityid;this.$http.get(t).then(function(t){e.info=t.data.data,e.loading=!1}).catch(function(t){e.$message.error("未找到相关信息"),e.$router.push("/"),console.log("fetch celebrity info error."),e.loading=!1})}}},xt=wt,$t=Object(d["a"])(xt,ct,mt,!1,null,null,null),kt=$t.exports,Mt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container-friends"},[a("div",{staticClass:"head"},[a("img",{staticClass:"img",attrs:{src:e.avatar}}),a("h1",[e._v("\n        \n      "),a("span",{staticClass:"title"},[e._v(e._s(e.username))]),e._v(" \n      "),"following"===e.friendsType?a("span",{staticClass:"cate"},[e._v("的关注")]):e._e(),"follower"===e.friendsType?a("span",{staticClass:"cate"},[e._v("的粉丝")]):e._e(),"following"===e.friendsType?a("span",{staticClass:"count"},[e._v("("+e._s(e.followingCount)+")")]):e._e(),"follower"===e.friendsType?a("span",{staticClass:"count"},[e._v("("+e._s(e.followerCount)+")")]):e._e()])]),a("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"following",label:"Ta的关注"}},[a("friendsList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{friendsItems:e.followingData}}),e.followingnext?a("div",{staticClass:"load-more",on:{click:e.loadMore}},[e._v("\n        加载更多\n      ")]):e._e()],1),a("el-tab-pane",{attrs:{name:"follower",label:"Ta的粉丝"}},[a("friendsList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{friendsItems:e.followerData}}),e.followerNext?a("div",{staticClass:"load-more",on:{click:e.loadMore}},[e._v("\n        加载更多\n      ")]):e._e()],1)],1)],1)},Pt=[],Et=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.friendsItems,function(t){return e.friendsItems?a("div",{staticClass:"card"},[a("el-card",{attrs:{shadow:"hover","body-style":{padding:"0px"}}},[a("div",{staticClass:"avatar"},[a("router-link",{attrs:{to:e.getProfileUrl(t.username)}},[a("img",{attrs:{src:t.avatar_image}})])],1),a("div",{staticClass:"content"},[a("router-link",{attrs:{to:e.getProfileUrl(t.username)}},[a("span",{staticClass:"username"},[e._v(e._s(t.username))])]),a("br"),a("div",{staticClass:"signature"},[a("span",[e._v(e._s(t.signature))])])],1)]),a("hr")],1):e._e()}),0)},It=[],St={props:["friendsItems"],data:function(){return{itemsData:this.friendsItems}},watch:{friendsItems:function(e,t){this.itemsData=e}},methods:{getProfileUrl:function(e){return"/people/"+e}}},Tt=St,Nt=(a("7ad9"),Object(d["a"])(Tt,Et,It,!1,null,null,null)),Dt=Nt.exports,Rt={props:["username","cate"],components:{friendsList:Dt},data:function(){return{friendsType:this.cate,loading:!0,followerData:[],followerNext:"",followingData:[],followingnext:"",followerCount:0,followingCount:0,avatar:""}},watch:{friendsType:function(e,t){"follower"===e?0===this.followerData.length&&this.fetchFriends(e):"following"===e&&0===this.followingData.length&&this.fetchFriends(e)}},computed:{activeName:{get:function(){return this.friendsType},set:function(e){this.friendsType=e}}},methods:{loadMore:function(){"follower"===this.friendsType?this.fetchFriends(this.friendsType,this.followerNext):this.fetchFriends(this.friendsType,this.followingnext)},validCate:function(){if("follower"!==this.cate&&"following"!==this.cate){var e="/people/"+this.username;this.$router.push(e)}},fetchFriends:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.loading=!0,a)var s=a;else s="/users/"+this.username+"/"+this.friendsType;this.$http.get(s).then(function(a){"follower"===e?(t.followerNext=a.data.data.next,t.followerData=t.followerData.concat(a.data.data.items),t.followerCount=a.data.data.total):"following"===e&&(t.followingnext=a.data.data.next,t.followingData=t.followingData.concat(a.data.data.items),t.followingCount=a.data.data.total),t.loading=!1}).catch(function(e){t.loading=!1})},fetchAvatar:function(e){var t=this,a="/user/"+e+"?type=summary";this.$http.get(a).then(function(e){t.avatar=e.data.avatar}).catch(function(e){console.log("fetch avatar error.")})}},created:function(){this.validCate(),this.fetchFriends(this.friendsType),this.fetchAvatar(this.username)}},Ot=Rt,jt=(a("bff1"),Object(d["a"])(Ot,Mt,Pt,!1,null,null,null)),qt=jt.exports,At=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"head"},[a("span",{staticClass:"title"},[e._v(e._s(e.title)+"...")]),e._v("    \n    "),a("a",{on:{click:e.togleType}},[a("span",{staticClass:"togle"},[e._v(e._s(e.otherTitle)+" ")])])]),a("movieList",{attrs:{movies:e.current.items,nextPage:e.current.next,load:e.loading}})],1)},Lt=[],Ut=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"moviesList",attrs:{"element-loading-text":"拼命加载中"}},[a("div",{staticClass:"movie-container"},[e._l(e.moviesItems,function(t){return a("div",{staticClass:"movieTag"},[a("ul",[a("li",{staticClass:"film-pic"},[a("router-link",{attrs:{to:"/movie/"+t.id}},[a("img",{staticClass:"movieImg",attrs:{src:t.image_url,alt:""}})])],1),a("li",{staticClass:"film-name"},[a("router-link",{attrs:{to:"/movie/"+t.id}},[e._v(e._s(t.title))])],1),a("li",{staticClass:"film-rate"},[a("el-rate",{attrs:{disabled:"","text-color":"#ff9900"},model:{value:t.score/2,callback:function(a){e.$set(t,"score / 2",a)},expression:"movie.score / 2"}})],1),a("li",{staticClass:"film-button"})])])}),e.next?a("div",{staticClass:"load-more",on:{click:e.loadMore}},[e._v("加载更多")]):e._e()],2)])},zt=[],Bt={props:["movies","nextPage","load"],data:function(){return{next:this.nextPage,moviesItems:this.movies,loading:this.load}},watch:{nextPage:function(e,t){this.next=e},movies:function(e,t){this.moviesItems=e},load:function(e,t){this.loading=e}},methods:{loadMore:function(){var e=this;this.loading=!0,this.$http.get(this.next).then(function(t){e.moviesItems=e.moviesItems.concat(t.data.data.items),e.next=t.data.data.next,e.loading=!1}).catch(function(t){e.loading=!1})}}},Vt=Bt,Jt=(a("8e87"),Object(d["a"])(Vt,Ut,zt,!1,null,null,null)),Gt=Jt.exports,Zt={components:{movieList:Gt},data:function(){return{error:!1,loading:!0,current:{items:[],next:""},coming:{items:[],next:""},showing:{items:[],next:""},currentType:"showing",title:"正在上映",otherTitle:"即将上映"}},mounted:function(){this.getMovie("showing"),this.current=this.showing},methods:{togleType:function(){0===this.coming.items.length&&this.getMovie("coming");var e=this.title;this.title=this.otherTitle,this.otherTitle=e,"showing"===this.currentType?(this.current=this.coming,this.currentType="coming"):(this.current=this.showing,this.currentType="showing")},getMovie:function(e){var t=this;if("coming"===e)var a="/movie/cinema/coming";else a="/movie/cinema/showing";this.loading=!0,this.$http.get(a).then(function(a){"showing"===e?(t.showing.items=a.data.data.items,t.showing.next=a.data.data.next):(t.coming.items=a.data.data.items,t.coming.next=a.data.data.next),t.loading=!1}).catch(function(e){t.error=!0,t.loading=!1})}}},Ht=Zt,Yt=(a("5106"),Object(d["a"])(Ht,At,Lt,!1,null,null,null)),Qt=Yt.exports,Kt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("movieList",{attrs:{movies:e.movieItems,nextPage:e.nextPage,load:e.loading}})],1)},Wt=[],Xt={components:{movieList:Gt},data:function(){return{error:!1,loading:!0,movieItems:[],nextPage:""}},mounted:function(){this.getMovie("/movie/recommend")},methods:{getMovie:function(e){var t=this;this.$http.get(e).then(function(e){t.movieItems=e.data.data.items,t.nextPage=e.data.data.next,t.loading=!1}).catch(function(e){t.error=!0,t.loading=!1})}}},ea=Xt,ta=Object(d["a"])(ea,Kt,Wt,!1,null,null,null),aa=ta.exports,sa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"head"},[a("span",{staticClass:"title"},[e._v(e._s(e.tagTitle||e.title))]),e._v("    \n    "),a("a",{on:{click:e.togleTitle}},[a("span",[e._v(e._s(e.otherTitle))])]),e._v("    \n    "),a("a",{on:{click:e.showTags}},[a("span",[e._v("分类排行榜")])])]),a("movieList",{attrs:{movies:e.movieItems,nextPage:e.nextPage,load:e.loading}}),a("el-dialog",{attrs:{title:"选择标签",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},e._l(e.tags,function(t){return e.tags?a("el-tag",{attrs:{type:"success"},on:{click:function(a){return e.choiceTag(t)}}},[e._v(e._s(t.genre_name)+"    ")]):e._e()}),1)],1)},oa=[],ia={components:{movieList:Gt},data:function(){return{dialogVisible:!1,error:!1,loading:!0,movieItems:[],nextPage:"",tagTitle:"",title:"周排行榜",otherTitle:"月排行榜",tags:[],currentTag:"",currentRange:"week"}},mounted:function(){this.getMovie("/movie/leader-board/week"),this.fetchTags()},methods:{choiceTag:function(e){console.log(e.id),this.currentTag=e.genre_name,this.dialogVisible=!1,this.tagTitle="豆瓣电影分类排行榜 - "+e.genre_name+"片";var t="/movie/genre/"+e.id;this.getMovie(t)},fetchTags:function(){var e=this;this.$http.get("/genre").then(function(t){e.tags=t.data.data}).catch(function(e){console.log("fetch tags error.")})},togleTitle:function(){var e=this.title;this.title=this.otherTitle,this.otherTitle=e,this.tagTitle="","week"===this.currentRange?(this.getMovie("/movie/leader-board/month"),this.currentRange="month"):(this.getMovie("/movie/leader-board/week"),this.currentRange="week")},showTags:function(){this.dialogVisible=!0},getMovie:function(e){var t=this;this.loading=!0,this.$http.get(e).then(function(e){t.movieItems=e.data.data.items,t.nextPage=e.data.data.next,t.loading=!1}).catch(function(e){t.error=!0,t.loading=!1})}}},ra=ia,na=Object(d["a"])(ra,sa,oa,!1,null,null,null),la=na.exports,ca=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"head"},[a("span",{staticClass:"title"},[e._v("选影视")]),a("br"),a("br"),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.changeChoice},model:{value:e.subtypeRadio,callback:function(t){e.subtypeRadio=t},expression:"subtypeRadio"}},[a("el-radio-button",{attrs:{label:"all"}},[e._v("全部形式")]),a("el-radio-button",{attrs:{label:"movie"}},[e._v("影视")]),a("el-radio-button",{attrs:{label:"tv"}},[e._v("电视剧")])],1)],1),a("div",{staticClass:"aaaaa",staticStyle:{"margin-top":"20px"}},[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.changeChoice},model:{value:e.tagRadio,callback:function(t){e.tagRadio=t},expression:"tagRadio"}},[a("el-radio-button",{attrs:{label:"all"}},[e._v("全部类型")]),e._l(e.tags,function(e){return a("el-radio-button",{attrs:{label:e.genre_name}})})],2)],1),a("div",{staticClass:"aaaaa",staticStyle:{"margin-top":"20px"}},[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.changeChoice},model:{value:e.countryRadio,callback:function(t){e.countryRadio=t},expression:"countryRadio"}},[a("el-radio-button",{attrs:{label:"all"}},[e._v("全部地区")]),e._l(e.countries,function(e){return a("el-radio-button",{attrs:{label:e.country_name}})})],2)],1),a("div",{staticClass:"aaaaa",staticStyle:{"margin-top":"20px"}},[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.changeChoice},model:{value:e.yearRadio,callback:function(t){e.yearRadio=t},expression:"yearRadio"}},[a("el-radio-button",{attrs:{label:"all"}},[e._v("全部时间")]),e._l(e.years,function(e){return a("el-radio-button",{attrs:{label:e}})})],2)],1)]),a("movieList",{attrs:{movies:e.movieItems,nextPage:e.nextPage,load:e.loading}})],1)},ma=[],ua={components:{movieList:Gt},data:function(){return{loading:!0,movieItems:[],nextPage:"",subtypeRadio:"all",yearRadio:"all",tagRadio:"all",countryRadio:"all",tags:[],countries:[],years:[],params:{subtype:"",type_name:"",country:"",year:""}}},methods:{changeChoice:function(){this.params.subtype=this.getValue(this.subtypeRadio),this.params.genre_name=this.getValue(this.tagRadio),this.params.country_name=this.getValue(this.countryRadio),this.params.year=this.getValue(this.yearRadio),console.log(this.params),this.fetchMovies()},getValue:function(e){return"all"===e?"":e},fetchTags:function(){var e=this;this.$http.get("/genre").then(function(t){e.tags=t.data.data}).catch(function(e){console.log("fetch tags error.")})},fetchCountries:function(){var e=this;this.$http.get("/country").then(function(t){e.countries=t.data.data}).catch(function(e){console.log("fetch country error.")})},fetchYears:function(){var e=this;this.$http.get("/year").then(function(t){e.years=t.data.data}).catch(function(e){console.log("fetch year error.")})},fetchMovies:function(){var e=this;this.$http.get("/movie/choice",{params:this.params}).then(function(t){e.movieItems=t.data.data.items,e.nextPage=t.data.data.next,e.loading=!1}).catch(function(t){e.loading=!1,console.log("fetch movies error.")})}},mounted:function(){this.fetchTags(),this.fetchCountries(),this.fetchYears(),this.fetchMovies()}},da=ua,pa=(a("5cf8"),Object(d["a"])(da,ca,ma,!1,null,null,null)),fa=pa.exports,va=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._m(0),a("br"),a("div",{staticClass:"setting-content"},[a("el-tabs",{staticStyle:{height:"400px"},attrs:{"tab-position":"left"}},[a("el-tab-pane",{attrs:{label:"基本信息"}},[a("profileSetting")],1),a("el-tab-pane",{attrs:{label:"更改头像"}},[a("avatarSetting")],1),a("el-tab-pane",{attrs:{label:"修改密码"}},[a("changePassword")],1),a("el-tab-pane",{attrs:{label:"修改邮箱"}},[a("changeEmail")],1),a("el-tab-pane",{attrs:{label:"删除账户"}},[a("deleteAccount")],1)],1)],1)])},ha=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"setting-head"},[a("span",{staticClass:"title"},[e._v("用户设置")])])}],ga=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"setting-avatar"},[a("div",{staticClass:"avatar-upload"},[a("div",{staticClass:"change-avatar"},[a("el-upload",{staticClass:"avatar-uploader",attrs:{drag:"",action:"","auto-upload":!1,"show-file-list":!1,"on-change":e.changeUpload}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("div",[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖拽到此处即可")]),a("div",{staticClass:"el-upload__tip"},[e._v("\n              支持 PNG/JPEG/JPG 图片格式，单张图片最大支持2MB\n            ")])])])],1)])]),a("el-dialog",{attrs:{title:"图片剪裁",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"cropper-content"},[a("div",{staticClass:"cropper",staticStyle:{"text-align":"center"}},[a("vueCropper",{ref:"cropper",attrs:{img:e.option.img,outputSize:e.option.size,outputType:e.option.outputType,info:!0,full:e.option.full,canMove:e.option.canMove,canMoveBox:e.option.canMoveBox,original:e.option.original,autoCrop:e.option.autoCrop,fixed:e.option.fixed,fixedNumber:e.option.fixedNumber,centerBox:e.option.centerBox,infoTrue:e.option.infoTrue,fixedBox:e.option.fixedBox}})],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.finish}},[e._v("上传")])],1)])],1)},ba=[],_a={data:function(){return{imageUrl:"",dialogVisible:!1,option:{img:"",info:!0,outputSize:1,outputType:"jpeg",canScale:!1,autoCrop:!0,fixedBox:!1,fixed:!0,fixedNumber:[1,1],full:!0,canMoveBox:!0,original:!1,centerBox:!0,infoTrue:!0},loading:!1,fileinfo:"",previews:{},fileName:""}},methods:{changeUpload:function(e,t){var a=this,s=e.size/1024/1024<2,o="image/jpeg"===e.raw.type||"image/png"===e.raw.type;return s?o?(this.fileName=e.raw.name,this.fileinfo=e,this.option.img=URL.createObjectURL(e.raw),void this.$nextTick(function(){a.dialogVisible=!0})):(this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),!1):(this.$message.error("上传文件大小不能超过 2MB!"),!1)},finish:function(){var e=this;this.$refs.cropper.getCropBlob(function(t){e.fileinfo.uid;var a=URL.createObjectURL(t);e.imageUrl=a;var s=new File([t],e.fileName);e.uploadAvatar(e.fileinfo.raw,s)}),this.dialogVisible=!1},uploadAvatar:function(e,t){var a=this;this.loading=!0;var s=new FormData;s.append("avatar_file",t),this.$http.patch("/users/current_user",s).then(function(e){a.loading=!1,a.$message.success("更换头像成功")}).catch(function(e){a.loading=!1,console.log("upload error"),a.$message.error("不小心失败啦")})}}},ya=_a,Fa=(a("62c6"),Object(d["a"])(ya,ga,ba,!1,null,null,null)),Ca=Fa.exports,wa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"profileForm",staticClass:"profile-form",attrs:{model:e.profileForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.profileForm.username,callback:function(t){e.$set(e.profileForm,"username",t)},expression:"profileForm.username"}})],1),a("el-form-item",{attrs:{label:"个性签名",prop:"signature"}},[a("el-input",{attrs:{type:"textarea",autocomplete:"off"},model:{value:e.profileForm.signature,callback:function(t){e.$set(e.profileForm,"signature",t)},expression:"profileForm.signature"}})],1),a("el-form-item",{attrs:{label:"长居地",prop:"location"}},[a("el-cascader",{attrs:{size:"large",options:e.areaData},on:{change:e.handleChange},model:{value:e.profileForm.location,callback:function(t){e.$set(e.profileForm,"location",t)},expression:"profileForm.location"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("profileForm")}}},[e._v("保存修改")]),a("el-button",{on:{click:function(t){return e.resetForm("profileForm")}}},[e._v("重置")])],1)],1)],1)},xa=[],$a={data:function(){var e=this,t=function(t,a,s){if(!a)return s(new Error("用户名不能为空"));var o=/^[a-zA-Z0-9\_]{6,16}$/,i=o.exec(a);if(!i)return s(new Error("用户名不符合要求"));e.$http.get("/user/test/username",{params:{value:a}}).then(function(t){a===e.currentUsername?s():s(new Error("用户名已存在"))}).catch(function(e){s()})},a=function(e,t,a){if(t.length>50)return a(new Error("长度不能超过50个字符"));a()};return{areaData:[],profileForm:{username:"",signature:"",location:[]},rules:{username:[{validator:t,trigger:"blur"}],signature:[{validator:a,trigger:"blur"}]},currentUsername:"",options:ot["provinceAndCityData"]}},methods:{handleChange:function(e){console.log(e)},resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit"),!1;t.putchInfo(),console.log("submit")})},getAreaData:function(){var e=this;this.$http.get("/area-code").then(function(t){e.areaData=t.data}).catch(function(e){console.log("get area data error.")})},fillFormDefault:function(){var e=this,t=this.$store.state.username;this.currentUsername=t,this.$http.get("/users").then(function(t){e.profileForm.username=t.data.username,e.profileForm.signature=t.data.signature}).catch(function(e){console.log("fetch default info error.")})},putchInfo:function(){var e=this,t=new URLSearchParams;t.append("username",this.profileForm.username),t.append("signature",this.profileForm.signature),t.append("city_id",this.profileForm.location[2]),console.log(this.profileForm.location[2]),this.$http.patch("/users/"+this.currentUsername,t).then(function(t){e.$message.success("修改成功!")}).catch(function(t){e.$message.error("修改失败,请稍后再试!")})}},created:function(){this.fillFormDefault(),this.getAreaData()}},ka=$a,Ma=(a("84a9"),Object(d["a"])(ka,wa,xa,!1,null,null,null)),Pa=Ma.exports,Ea=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"changePassForm",staticClass:"change-password-form",attrs:{model:e.changePassForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"旧密码",prop:"oldPass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.changePassForm.oldPass,callback:function(t){e.$set(e.changePassForm,"oldPass",t)},expression:"changePassForm.oldPass"}})],1),a("el-form-item",{attrs:{label:"新密码",prop:"pass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.changePassForm.pass,callback:function(t){e.$set(e.changePassForm,"pass",t)},expression:"changePassForm.pass"}})],1),a("el-form-item",{attrs:{label:"再次确认",prop:"checkPass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.changePassForm.checkPass,callback:function(t){e.$set(e.changePassForm,"checkPass",t)},expression:"changePassForm.checkPass"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("changePassForm")}}},[e._v("保存修改")]),a("el-button",{on:{click:function(t){return e.resetForm("changePassForm")}}},[e._v("重置")])],1)],1)],1)},Ia=[],Sa={data:function(){var e=this,t=function(t,a,s){""===a&&s(new Error("请输入密码"));var o=/^[0-9a-zA-Z\_\.\!\@\#\$\%\^\&\*]{6,20}$/,i=o.exec(a);if(!i)return s(new Error("密码不符合要求"));""!==e.changePassForm.checkPass&&e.$refs.changePassForm.validateField("checkPass"),s()},a=function(t,a,s){""===a&&s(new Error("请再次输入密码"));var o=/^[0-9a-zA-Z\_\.\!\@\#\$\%\^\&\*]{6,20}$/,i=o.exec(a);if(!i)return s(new Error("密码不符合要求"));a!==e.changePassForm.pass?s(new Error("两次输入密码不一致")):s()};return{changePassForm:{oldPass:"",pass:"",checkPass:""},rules:{pass:[{validator:t,trigger:"blur"}],checkPass:[{validator:a,trigger:"blur"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit"),!1;t.modifyPass(),console.log("ok")})},resetForm:function(e){this.$refs[e].resetFields()},modifyPass:function(){var e=this,t=new URLSearchParams;t.append("old_password",this.changePassForm.oldPass),t.append("new_password",this.changePassForm.pass),this.$http.patch("/user/password",t).then(function(t){e.$message.success(t.data.message)}).catch(function(t){e.$message.error(t.response.data.message)})}}},Ta=Sa,Na=(a("40eb"),Object(d["a"])(Ta,Ea,Ia,!1,null,null,null)),Da=Na.exports,Ra=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"change-email"},[a("div",[a("span",{staticClass:"label"},[e._v("邮箱:")]),a("span",[e._v(e._s(e.currentEmail))]),e._v("    \n    "),a("a",{on:{click:e.changeEmail}},[e._v("更改邮箱")])])])},Oa=[],ja={data:function(){return{currentEmail:""}},methods:{_changeEmail:function(){var e=this;this.$http.put("/user/email").then(function(t){e.$message.success(t.data.message)}).catch(function(t){e.$message.error(t.response.data.message+"，请 "+t.response.data.second+" 秒后重试！")})},changeEmail:function(){var e=this;this.$confirm("此操作将更换绑定邮箱, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(t){e._changeEmail()}).catch(function(e){})},fetchEmail:function(){var e=this;this.$http.get("/users").then(function(t){e.currentEmail=t.data.email}).catch(function(e){console.log("fetch email error")})}},created:function(){this.fetchEmail()}},qa=ja,Aa=(a("ce8c"),Object(d["a"])(qa,Ra,Oa,!1,null,null,null)),La=Aa.exports,Ua=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"delete-account"},[a("p",[e._v("删除账号后您的账号不可恢复")]),a("p",[e._v("您的私有数据将被永远删除")]),a("br"),a("a",{on:{click:e.open}},[e._v("是否仍要注销")])])])},za=[],Ba={data:function(){return{password:""}},methods:{open:function(){var e=this;this.$prompt("请输入密码","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[\s\S]*.*[^\s][\s\S]*$/,inputErrorMessage:"密码不能为空!",inputType:"password"}).then(function(t){var a=t.value;e.password=a,e.$confirm("此操作将永久删除账号, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(t){e._deleteAccount()}).catch(function(e){})}).catch(function(){e.$message({type:"info",message:"取消输入"})})},logout:function(){localStorage.removeItem("isLogin"),localStorage.removeItem("token"),this.$router.push("/"),this.$store.commit("changeLogin",!1)},_deleteAccount:function(){var e=this,t=new URLSearchParams;t.append("password",this.password),this.$http.delete("/users/current_user",{data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){e.$message.success("成功删除账号!"),e.logout()}).catch(function(t){e.$message.error(" 请确认密码后重试!")})}}},Va=Ba,Ja=(a("8bb3"),Object(d["a"])(Va,Ua,za,!1,null,null,null)),Ga=Ja.exports,Za={components:{avatarSetting:Ca,profileSetting:Pa,changePassword:Da,changeEmail:La,deleteAccount:Ga},data:function(){return{}}},Ha=Za,Ya=(a("cc26"),Object(d["a"])(Ha,va,ha,!1,null,null,null)),Qa=Ya.exports,Ka=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._m(0),a("div",{staticClass:"notifition-content"},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"赞",name:"like"}},[a("likeNotification")],1),a("el-tab-pane",{attrs:{label:"新的关注",name:"friends"}},[a("friendNotification")],1)],1)],1)])},Wa=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"head"},[a("span",{staticClass:"title"},[e._v("我的提醒")])])}],Xa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.likeData,function(t){return 0!==e.likeData.length?a("div",[t.movie?a("el-card",{attrs:{"body-style":{padding:"0px",height:"60px"},shadow:"hover"}},[a("img",{staticClass:"avatar",attrs:{src:t.send_user.avatar_image}}),a("div",{staticClass:"like-content"},[a("router-link",{attrs:{to:"/people/"+t.send_user.username}},[e._v(e._s(t.send_user.username)+"  ")]),e._v("点赞了你在  \n        "),a("router-link",{attrs:{to:"/movie/"+t.movie.id}},[e._v(e._s(t.movie.title)+"  ")]),a("span",[e._v("下的评价")]),a("span",{staticClass:"time"},[e._v(e._s(t.when))])],1)]):e._e(),a("br")],1):e._e()}),e.next?a("div",{staticClass:"load-more",on:{click:function(t){return e.fetchNotifications(e.next)}}},[e._v("\n    加载更多\n  ")]):e._e()],2)},es=[],ts={data:function(){return{likeData:[],next:""}},methods:{fetchNotifications:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(t)var a=t;else a="/notification/like";this.$http.get(a).then(function(t){e.likeData=e.likeData.concat(t.data.data.items),e.next=t.data.data.next}).catch(function(e){console.log("fetch like data error.")})}},created:function(){this.fetchNotifications()}},as=ts,ss=(a("8df2"),Object(d["a"])(as,Xa,es,!1,null,null,null)),os=ss.exports,is=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.friendData,function(t){return 0!==e.friendData.length?a("div",[a("el-card",{attrs:{"body-style":{padding:"0px",height:"60px"},shadow:"hover"}},[a("img",{staticClass:"avatar",attrs:{src:t.send_user.avatar_thumb}}),a("div",{staticClass:"friend-content"},[a("router-link",{attrs:{to:"/people/"+t.send_user.username}},[e._v(e._s(t.send_user.username)+"  ")]),a("span",[e._v("关注了你")]),a("span",{staticClass:"time"},[e._v(e._s(t.when.replace("T"," ")))])],1)]),a("br")],1):e._e()}),e.next?a("div",{staticClass:"load-more",on:{click:function(t){return e.fetchNotifications(e.next)}}},[e._v("\n    加载更多\n  ")]):e._e()],2)},rs=[],ns={data:function(){return{friendData:[],next:""}},methods:{fetchNotifications:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(t)var a=t;else a="/notification/friendship";this.$http.get(a).then(function(t){e.friendData=e.friendData.concat(t.data.data.items),e.next=t.data.data.next,console.log("zxcv"),console.log(e.friendData)}).catch(function(e){console.log("fetch friend data error.")}),console.log("heww"),console.log(this.friendData)}},created:function(){this.fetchNotifications()}},ls=ns,cs=(a("c329"),Object(d["a"])(ls,is,rs,!1,null,null,null)),ms=cs.exports,us={components:{likeNotification:os,friendNotification:ms},data:function(){return{activeName:"like"}},methods:{handleClick:function(){console.log(this.activeName)}}},ds=us,ps=(a("c650"),Object(d["a"])(ds,Ka,Wa,!1,null,null,null)),fs=ps.exports,vs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._m(0),a("br"),a("div",{staticClass:"setting-content"},[a("el-tabs",{attrs:{"tab-position":"left"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"添加影视",name:"uploadMovie"}},[a("uploadMovie",{on:{toUploadCelebrityTab:e.toUploadCelebrityTab}})],1),a("el-tab-pane",{attrs:{label:"添加影人",name:"uploadCelebrity"}},[a("uploadCelebrity")],1),a("el-tab-pane",{attrs:{label:"处理举报评论"}},[a("handleReportRating")],1)],1)],1)])},hs=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"setting-head"},[a("span",{staticClass:"title"},[e._v("管理员")])])}],gs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e._l(e.ratings,function(t,s){return e.ratings?a("div",{staticClass:"movie"},[a("el-card",{attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[a("img",{staticClass:"image",attrs:{src:t.movie.image_url}}),a("div",{staticClass:"content"},[a("span",{staticClass:"movie-title"},[e._v(e._s(t.movie.title))]),a("span",{staticClass:"movie-year"},[e._v(e._s(t.movie.year))]),a("br"),a("br"),a("el-rate",{attrs:{disabled:"","text-color":"#ff9900","score-template":"{value}"},model:{value:t.score/2,callback:function(a){e.$set(t,"score / 2",a)},expression:"rating.score / 2"}}),0!==t.tags.length?a("span",[e._v("\n          标签:  \n          "),e._l(t.tags,function(t){return a("small",[e._v(e._s(t+" "))])})],2):e._e(),a("br"),t.comment?a("span",[e._v("\n          评价:  \n          "),a("small",[e._v(e._s(t.comment))])]):e._e(),a("br"),a("small",{staticClass:"time"},[e._v(e._s(t.when.replace("T"," ")))])],1),a("div",[a("el-button",{staticClass:"delete-button",attrs:{type:"danger"},on:{click:function(t){return e.openConfirm(s)}}},[e._v("删除评价")])],1)]),a("br")],1):e._e()}),e.next?a("div",{staticClass:"load-more",on:{click:function(t){return e.fetchReportRatings(e.next)}}},[e._v("\n    加载更多\n  ")]):e._e()],2)},bs=[],_s={data:function(){return{ratings:[],next:"",loading:!0}},methods:{openConfirm:function(e){var t=this;this.$confirm("此操作将永久删除该评价, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.deleteRating(e)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},fetchReportRatings:function(e){var t=this;if(this.loading=!0,e)var a=e;else a="/rating/reported";this.$http.get(a).then(function(e){t.ratings=t.ratings.concat(e.data.data.items),t.next=e.data.data.next,t.loading=!1}).catch(function(e){t.loading=!1,console.log("fetch report ratings error")})},deleteRating:function(e){var t=this,a=this.ratings[e].id;this.$http.delete("/rating/"+a).then(function(a){t.$message.success("删除成功"),t.ratings.splice(e)}).catch(function(e){t.$message.error("删除失败")})}},created:function(){this.fetchReportRatings()}},ys=_s,Fs=(a("d524"),Object(d["a"])(ys,gs,bs,!1,null,null,null)),Cs=Fs.exports,ws=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"celebrityForm",staticClass:"celebrity-form ",attrs:{model:e.celebrityForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"影人名称",prop:"name"}},[a("el-input",{model:{value:e.celebrityForm.name,callback:function(t){e.$set(e.celebrityForm,"name",t)},expression:"celebrityForm.name"}})],1),a("el-form-item",{attrs:{label:"影人性别",prop:"gender"}},[a("el-select",{attrs:{placeholder:"请选择性别"},model:{value:e.celebrityForm.gender,callback:function(t){e.$set(e.celebrityForm,"gender",t)},expression:"celebrityForm.gender"}},[a("el-option",{attrs:{label:"男",value:"male"}}),a("el-option",{attrs:{label:"女",value:"female"}})],1)],1),a("el-form-item",{attrs:{label:"豆瓣ID",prop:"douban_id"}},[a("el-input",{model:{value:e.celebrityForm.douban_id,callback:function(t){e.$set(e.celebrityForm,"douban_id",t)},expression:"celebrityForm.douban_id"}})],1),a("el-form-item",{attrs:{label:"英文名",prop:"nama_en"}},[a("el-input",{model:{value:e.celebrityForm.nama_en,callback:function(t){e.$set(e.celebrityForm,"nama_en",t)},expression:"celebrityForm.nama_en"}})],1),a("el-form-item",{attrs:{label:"出生地",prop:"born_place"}},[a("el-input",{model:{value:e.celebrityForm.born_place,callback:function(t){e.$set(e.celebrityForm,"born_place",t)},expression:"celebrityForm.born_place"}})],1),a("el-form-item",{attrs:{label:"又名",prop:"aka"}},[a("el-input",{attrs:{placeholder:"多个又名以'/'分割"},model:{value:e.celebrityForm.aka,callback:function(t){e.$set(e.celebrityForm,"aka",t)},expression:"celebrityForm.aka"}})],1),a("el-form-item",{attrs:{label:"外文名",prop:"aka_en"}},[a("el-input",{attrs:{placeholder:"多个外文名以'/'分割"},model:{value:e.celebrityForm.aka_en,callback:function(t){e.$set(e.celebrityForm,"aka_en",t)},expression:"celebrityForm.aka_en"}})],1),a("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"","file-list":e.celebrityForm.avatarFile,"auto-upload":!1,"on-change":e.handleChange,"show-file-list":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("\n          只能上传jpg/png文件，且不超过2Mb\n        ")])],1)],1),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm("celebrityForm")}}},[e._v("立即创建")]),a("el-button",{on:{click:function(t){return e.resetForm("celebrityForm")}}},[e._v("重置")])],1)],1)],1)},xs=[],$s={data:function(){return{celebrityForm:{name:"",gender:"",douban_id:"",name_en:"",born_place:"",aka:"",aka_en:"",avatar:[]},rules:{name:[{required:!0,message:"请输入影人姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择艺人性别",trigger:"change"}],avatar:[{required:!0,message:"请选择影人头像",trigger:"blur"}]},loading:!1}},methods:{handleChange:function(e,t){var a=e.size/1024/1024<2,s="image/jpeg"===e.raw.type||"image/png"===e.raw.type;return a?s?(this.$message.success("添加头像成功"),void(this.celebrityForm.avatar=e)):(this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),!1):(this.$message.error("上传文件大小不能超过 2MB!"),!1)},resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){return e?t.celebrityForm.avatar?void t.uploadCelebrity():(t.$message.error("请添加头像"),!1):(console.log("error submit!!"),!1)})},uploadCelebrity:function(){var e=this;this.loading=!0;var t=new FormData;t.append("image",this.celebrityForm.avatar.raw),t.append("name",this.celebrityForm.name),t.append("douban_id",this.celebrityForm.douban_id),t.append("gender",this.celebrityForm.gender),t.append("name_en",this.celebrityForm.name_en),t.append("born_place",this.celebrityForm.born_place),t.append("aka",this.celebrityForm.aka),t.append("aka_en",this.celebrityForm.aka_en),this.$http.post("/celebrity",t).then(function(t){e.loading=!1,e.$message.success("影人信息添加成功")}).catch(function(t){e.loading=!1,e.$message.error("添加失败,请稍后再试")})}}},ks=$s,Ms=(a("2948"),Object(d["a"])(ks,ws,xs,!1,null,null,null)),Ps=Ms.exports,Es=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"movieForm",staticClass:"movie-form",attrs:{model:e.movieForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"名称",prop:"title"}},[a("el-input",{model:{value:e.movieForm.title,callback:function(t){e.$set(e.movieForm,"title",t)},expression:"movieForm.title"}})],1),a("el-form-item",{attrs:{label:"类别",prop:"subtype"}},[a("el-select",{attrs:{placeholder:"请选择类别"},model:{value:e.movieForm.subtype,callback:function(t){e.$set(e.movieForm,"subtype",t)},expression:"movieForm.subtype"}},[a("el-option",{attrs:{label:"电影",value:"movie"}}),a("el-option",{attrs:{label:"电视剧",value:"tv"}})],1)],1),"movie"===e.movieForm.subtype?a("el-form-item",{attrs:{label:"院线状态",prop:"subtype"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.movieForm.cinema_status,callback:function(t){e.$set(e.movieForm,"cinema_status",t)},expression:"movieForm.cinema_status"}},[a("el-option",{attrs:{label:"结束上映",value:"0"}}),a("el-option",{attrs:{label:"正在上映",value:"1"}}),a("el-option",{attrs:{label:"即将上映",value:"2"}})],1)],1):e._e(),a("el-form-item",{attrs:{label:"豆瓣ID",prop:"douban_id"}},[a("el-input",{model:{value:e.movieForm.douban_id,callback:function(t){e.$set(e.movieForm,"douban_id",t)},expression:"movieForm.douban_id"}})],1),a("el-form-item",{attrs:{label:"年份",prop:"year"}},[a("el-select",{attrs:{placeholder:"请选择年份"},model:{value:e.movieForm.year,callback:function(t){e.$set(e.movieForm,"year",t)},expression:"movieForm.year"}},e._l(e.yearOptions,function(e){return a("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}),1)],1),"tv"===e.movieForm.subtype?a("el-form-item",{attrs:{label:"季数",prop:"current_season"}},[a("el-input",{attrs:{type:"number"},model:{value:e.movieForm.current_season,callback:function(t){e.$set(e.movieForm,"current_season",t)},expression:"movieForm.current_season"}})],1):e._e(),"tv"===e.movieForm.subtype?a("el-form-item",{attrs:{label:"集数",prop:"episodes_count"}},[a("el-input",{attrs:{type:"number"},model:{value:e.movieForm.episodes_count,callback:function(t){e.$set(e.movieForm,"episodes_count",t)},expression:"movieForm.episodes_count"}})],1):e._e(),"tv"===e.movieForm.subtype?a("el-form-item",{attrs:{label:"总季数",prop:"seasons_count"}},[a("el-input",{attrs:{type:"number"},model:{value:e.movieForm.seasons_count,callback:function(t){e.$set(e.movieForm,"seasons_count",t)},expression:"movieForm.seasons_count"}})],1):e._e(),a("el-form-item",{attrs:{label:"标签",prop:"genres"}},[a("el-input",{attrs:{placeholder:"多个标签以空格分割"},model:{value:e.movieForm.genres,callback:function(t){e.$set(e.movieForm,"genres",t)},expression:"movieForm.genres"}})],1),a("el-form-item",{attrs:{label:"国家",prop:"countries"}},[a("el-input",{attrs:{placeholder:"多个国家以空格分割"},model:{value:e.movieForm.countries,callback:function(t){e.$set(e.movieForm,"countries",t)},expression:"movieForm.countries"}})],1),a("el-form-item",{attrs:{label:"导演",prop:"directors"}},[a("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",filterable:"",remote:"","collapse-tags":"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.queryCelebrity},model:{value:e.movieForm.directors,callback:function(t){e.$set(e.movieForm,"directors",t)},expression:"movieForm.directors"}},e._l(e.directorsOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.label,value:t.id}},[a("img",{staticStyle:{"max-height":"50px"},attrs:{src:t.image}}),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.label))]),a("br")])}),1),a("el-button",{attrs:{type:"text"},on:{click:e.changeTab}},[e._v("没有找到相关导演?")])],1),a("el-form-item",{attrs:{label:"演员",prop:"casts"}},[a("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",filterable:"",remote:"","collapse-tags":"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.queryCelebrity},model:{value:e.movieForm.casts,callback:function(t){e.$set(e.movieForm,"casts",t)},expression:"movieForm.casts"}},e._l(e.directorsOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.label,value:t.id}},[a("img",{staticStyle:{"max-height":"50px"},attrs:{src:t.image}}),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.label))]),a("br")])}),1),a("el-button",{attrs:{type:"text"},on:{click:e.changeTab}},[e._v("没有找到相关演员?")])],1),a("el-form-item",{attrs:{label:"原名",prop:"original_title"}},[a("el-input",{model:{value:e.movieForm.original_title,callback:function(t){e.$set(e.movieForm,"original_title",t)},expression:"movieForm.original_title"}})],1),a("el-form-item",{attrs:{label:"又名",prop:"aka"}},[a("el-input",{attrs:{placeholder:"多个又名以空格分割"},model:{value:e.movieForm.aka,callback:function(t){e.$set(e.movieForm,"aka",t)},expression:"movieForm.aka"}})],1),a("el-form-item",{attrs:{label:"摘要",prop:"summary"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.movieForm.summary,callback:function(t){e.$set(e.movieForm,"summary",t)},expression:"movieForm.summary"}})],1),a("el-form-item",{attrs:{label:"图片",prop:"image"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"","file-list":e.movieForm.imageFile,"auto-upload":!1,"on-change":e.handleChange,"show-file-list":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("\n          只能上传jpg/png文件，且不超过2Mb\n        ")])],1)],1),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm("movieForm")}}},[e._v("立即创建")]),a("el-button",{on:{click:function(t){return e.resetForm("movieForm")}}},[e._v("重置")])],1)],1)],1)},Is=[],Ss={data:function(){return{yearOptions:[],next:"",loading:!1,state:"",directorsOptions:[],movieForm:{title:"",subtype:"movie",cinema_status:"1",douban_id:"",year:2020,image:"",countries:"",original_title:"",summary:"",aka:"",genres:"",directors:[],casts:[],current_season:0,seasons_count:0,episodes_count:0},rules:{title:[{required:!0,message:"请输入名称",trigger:"blur"}],year:[{required:!0,message:"请输入年份",trigger:"blur"}],subtype:[{required:!0,message:"请选择类型",trigger:"change"}],image:[{required:!0,message:"请选择图片",trigger:"blur"}],summary:[{required:!0,message:"请输入摘要",trigger:"blur"}],countries:[{required:!0,message:"请输入国家信息",trigger:"blur"}],genres:[{required:!0,message:"请输入标签",trigger:"blur"}],directors:[{required:!0,message:"请选择导演",trigger:"change"}],casts:[{required:!0,message:"请选择演员",trigger:"change"}]}}},created:function(){this.generateYears()},methods:{generateYears:function(){for(var e=1900;e<=2030;e++)this.yearOptions.push({key:e,value:e})},handleCastChange:function(e){console.log(e)},changeTab:function(){this.$emit("toUploadCelebrityTab","")},queryCelebrity:function(e){var t=this;this.directorsOptions=[],""!==e?this.$http.get("/search",{params:{cate:"celebrity",q:e}}).then(function(e){for(var a=0;a<e.data.data.items.length;a++)t.directorsOptions.push({label:e.data.data.items[a].name,id:e.data.data.items[a].id,image:e.data.data.items[a].avatar_url})}).catch(function(e){console.log(e)}):this.directorsOptions=[]},handleChange:function(e,t){var a=e.size/1024/1024<2,s="image/jpeg"===e.raw.type||"image/png"===e.raw.type;return a?s?(this.$message.success("添加图片成功"),void(this.movieForm.image=e)):(this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),!1):(this.$message.error("上传文件大小不能超过 2MB!"),!1)},resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.createMovie()})},arrayToString:function(e){for(var t="",a=0;a<e.length;a++)t=t+e[a]+" ";return t},createMovie:function(){var e=this;this.loading=!0;var t=this.arrayToString(this.movieForm.casts),a=this.arrayToString(this.movieForm.directors),s=new FormData;s.append("douban_id",this.movieForm.douban_id),s.append("title",this.movieForm.title),s.append("subtype",this.movieForm.subtype),s.append("year",this.movieForm.year),s.append("image",this.movieForm.image.raw),s.append("countries",this.movieForm.countries),s.append("genres_name",this.movieForm.genres),s.append("original_title",this.movieForm.original_title),s.append("summary",this.movieForm.summary),s.append("aka",this.movieForm.aka),s.append("director_ids",a),s.append("celebrities_ids",t),"tv"===this.movieForm.subtype?(s.append("seasons_count",this.movieForm.seasons_count),s.append("episodes_count",this.movieForm.episodes_count),s.append("current_season",this.movieForm.current_season)):s.append("cinema_status",this.movieForm.cinema_status),this.$http.post("/movie",s).then(function(t){e.loading=!1,e.$message.success("电影信息添加成功")}).catch(function(t){e.loading=!1,e.$message.error("添加失败,请稍后再试")})}}},Ts=Ss,Ns=(a("e0b7"),Object(d["a"])(Ts,Es,Is,!1,null,null,null)),Ds=Ns.exports,Rs={components:{handleReportRating:Cs,uploadCelebrity:Ps,uploadMovie:Ds},data:function(){return{activeName:"uploadMovie"}},methods:{toUploadCelebrityTab:function(e){this.activeName="uploadCelebrity"}}},Os=Rs,js=Object(d["a"])(Os,vs,hs,!1,null,null,null),qs=js.exports,As=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"head"},[a("span",{staticClass:"title"},[e._v("修改电影信息")]),a("br"),a("br"),a("el-form",{ref:"movieForm",staticClass:"movie-form",attrs:{model:e.movieForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"名称",prop:"title"}},[a("el-input",{model:{value:e.movieForm.title,callback:function(t){e.$set(e.movieForm,"title",t)},expression:"movieForm.title"}})],1),a("el-form-item",{attrs:{label:"类别",prop:"subtype"}},[a("el-select",{attrs:{placeholder:"请选择类别"},model:{value:e.movieForm.subtype,callback:function(t){e.$set(e.movieForm,"subtype",t)},expression:"movieForm.subtype"}},[a("el-option",{attrs:{label:"电影",value:"movie"}}),a("el-option",{attrs:{label:"电视剧",value:"tv"}})],1)],1),"movie"===e.movieForm.subtype?a("el-form-item",{attrs:{label:"院线状态",prop:"subtype"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.movieForm.cinema_status,callback:function(t){e.$set(e.movieForm,"cinema_status",t)},expression:"movieForm.cinema_status"}},[a("el-option",{attrs:{label:"结束上映",value:"0"}}),a("el-option",{attrs:{label:"正在上映",value:"1"}}),a("el-option",{attrs:{label:"即将上映",value:"2"}})],1)],1):e._e(),a("el-form-item",{attrs:{label:"豆瓣ID",prop:"douban_id"}},[a("el-input",{model:{value:e.movieForm.douban_id,callback:function(t){e.$set(e.movieForm,"douban_id",t)},expression:"movieForm.douban_id"}})],1),a("el-form-item",{attrs:{label:"年份",prop:"year"}},[a("el-select",{attrs:{placeholder:"请选择年份"},model:{value:e.movieForm.year,callback:function(t){e.$set(e.movieForm,"year",t)},expression:"movieForm.year"}},e._l(e.yearOptions,function(e){return a("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}),1)],1),"tv"===e.movieForm.subtype?a("el-form-item",{attrs:{label:"季数",prop:"current_season"}},[a("el-input",{attrs:{type:"number"},model:{value:e.movieForm.current_season,callback:function(t){e.$set(e.movieForm,"current_season",t)},expression:"movieForm.current_season"}})],1):e._e(),"tv"===e.movieForm.subtype?a("el-form-item",{attrs:{label:"集数",prop:"episodes_count"}},[a("el-input",{attrs:{type:"number"},model:{value:e.movieForm.episodes_count,callback:function(t){e.$set(e.movieForm,"episodes_count",t)},expression:"movieForm.episodes_count"}})],1):e._e(),"tv"===e.movieForm.subtype?a("el-form-item",{attrs:{label:"总季数",prop:"seasons_count"}},[a("el-input",{attrs:{type:"number"},model:{value:e.movieForm.seasons_count,callback:function(t){e.$set(e.movieForm,"seasons_count",t)},expression:"movieForm.seasons_count"}})],1):e._e(),a("el-form-item",{attrs:{label:"标签",prop:"genres"}},[a("el-input",{attrs:{placeholder:"多个标签以空格分割"},model:{value:e.movieForm.genres,callback:function(t){e.$set(e.movieForm,"genres",t)},expression:"movieForm.genres"}})],1),a("el-form-item",{attrs:{label:"国家",prop:"countries"}},[a("el-input",{attrs:{placeholder:"多个国家以空格分割"},model:{value:e.movieForm.countries,callback:function(t){e.$set(e.movieForm,"countries",t)},expression:"movieForm.countries"}})],1),a("el-form-item",{attrs:{label:"导演",prop:"directors"}},[a("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",filterable:"",remote:"","collapse-tags":"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.queryDirectors},model:{value:e.movieForm.directors,callback:function(t){e.$set(e.movieForm,"directors",t)},expression:"movieForm.directors"}},e._l(e.directorsOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.label,value:t.id}},[a("img",{staticStyle:{"max-height":"50px"},attrs:{src:t.image}}),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v("\n            "+e._s(t.label)+"\n          ")]),a("br")])}),1),a("el-button",{attrs:{type:"text"},on:{click:e.changeTab}},[e._v("没有找到相关导演?")])],1),a("el-form-item",{attrs:{label:"演员",prop:"casts"}},[a("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",filterable:"",remote:"","collapse-tags":"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.queryCelebrities},model:{value:e.movieForm.casts,callback:function(t){e.$set(e.movieForm,"casts",t)},expression:"movieForm.casts"}},e._l(e.celebritiesOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.label,value:t.id}},[a("img",{staticStyle:{"max-height":"50px"},attrs:{src:t.image}}),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v("\n            "+e._s(t.label)+"\n          ")]),a("br")])}),1),a("el-button",{attrs:{type:"text"},on:{click:e.changeTab}},[e._v("没有找到相关演员?")])],1),a("el-form-item",{attrs:{label:"原名",prop:"original_title"}},[a("el-input",{model:{value:e.movieForm.original_title,callback:function(t){e.$set(e.movieForm,"original_title",t)},expression:"movieForm.original_title"}})],1),a("el-form-item",{attrs:{label:"又名",prop:"aka"}},[a("el-input",{attrs:{placeholder:"多个又名以空格分割"},model:{value:e.movieForm.aka,callback:function(t){e.$set(e.movieForm,"aka",t)},expression:"movieForm.aka"}})],1),a("el-form-item",{attrs:{label:"摘要",prop:"summary"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.movieForm.summary,callback:function(t){e.$set(e.movieForm,"summary",t)},expression:"movieForm.summary"}})],1),a("el-form-item",{attrs:{label:"图片",prop:"image"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"","file-list":e.movieForm.imageFile,"auto-upload":!1,"on-change":e.handleChange,"show-file-list":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过2Mb")])],1)],1),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm("movieForm")}}},[e._v("修改电影信息")]),a("el-button",{on:{click:function(t){return e.resetForm("movieForm")}}},[e._v("重置")])],1)],1)],1)},Ls=[],Us=(a("6b54"),{data:function(){return{yearOptions:[],next:"",loading:!1,state:"",directorsOptions:[],celebritiesOptions:[],movieForm:{title:"",subtype:"movie",cinema_status:"1",douban_id:"",year:2020,image:"",countries:"",original_title:"",summary:"",aka:"",genres:"",directors:[],casts:[],current_season:0,seasons_count:0,episodes_count:0},rules:{title:[{required:!0,message:"请输入名称",trigger:"blur"}],year:[{required:!0,message:"请输入年份",trigger:"blur"}],subtype:[{required:!0,message:"请选择类型",trigger:"change"}],summary:[{required:!0,message:"请输入摘要",trigger:"blur"}],countries:[{required:!0,message:"请输入国家信息",trigger:"blur"}],genres:[{required:!0,message:"请输入标签",trigger:"blur"}]}}},created:function(){var e=this;this.generateYears();var t="/movie/"+this.$route.params.movieid;this.$http.get(t).then(function(t){var a=t.data.data;e.movieForm.title=a.title,e.movieForm.subtype=a.subtype,e.movieForm.cinema_status=a.cinema_status.toString(),e.movieForm.douban_id=a.douban_id,e.movieForm.year=a.year,console.log(a);for(var s=0;s<a.countries.length;s++)e.movieForm.countries+=a.countries[s]["country_name"]+" ";e.movieForm.original_title=a.original_title,e.movieForm.summary=a.summary;for(s=0;s<a.aka_list.length;s++)e.movieForm.aka+=a.aka_list[s]+" ";console.log("here");for(s=0;s<a.genres.length;s++)e.movieForm.genres+=a.genres[s]["genre_name"]+" ";for(s=0;s<a.directors.length;s++)e.directorsOptions.push({label:a.directors[s].name,id:a.directors[s].id,image:a.directors[s].avatar_url}),e.movieForm.directors.push(a.directors[s]["id"]);for(s=0;s<a.celebrities.length;s++)e.celebritiesOptions.push({label:a.celebrities[s].name,id:a.celebrities[s].id,image:a.celebrities[s].avatar_url}),e.movieForm.casts.push(a.celebrities[s]["id"]);e.movieForm.current_season=a.current_season,e.movieForm.seasons_count=a.seasons_count,e.movieForm.episodes_count=a.episodes_count}).catch(function(t){e.$message.error("未找到相关信息"),e.$router.push("/"),console.log("get movie detail error")})},methods:{generateYears:function(){for(var e=1900;e<=2030;e++)this.yearOptions.push({key:e,value:e})},handleCastChange:function(e){console.log(e)},changeTab:function(){this.$emit("toUploadCelebrityTab","")},forQuery:function(e,t){var a=this;this.directorsOptions=[],""!==e?this.$http.get("/search",{params:{cate:"celebrity",q:e}}).then(function(e){if("directors"===t)for(var s=0;s<e.data.data.items.length;s++)a.directorsOptions.push({label:e.data.data.items[s].name,id:e.data.data.items[s].id,image:e.data.data.items[s].avatar_url});else for(s=0;s<e.data.data.items.length;s++)a.celebritiesOptions.push({label:e.data.data.items[s].name,id:e.data.data.items[s].id,image:e.data.data.items[s].avatar_url})}).catch(function(e){console.log(e)}):this.directorsOptions=[]},queryDirectors:function(e){this.forQuery(e,"directors")},queryCelebrities:function(e){this.forQuery(e,"celebrities")},handleChange:function(e,t){var a=e.size/1024/1024<2,s="image/jpeg"===e.raw.type||"image/png"===e.raw.type;return a?s?(this.$message.success("添加图片成功"),void(this.movieForm.image=e)):(this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),!1):(this.$message.error("上传文件大小不能超过 2MB!"),!1)},resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this;console.log(this.movieForm),this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.updateMovie()})},arrayToString:function(e){for(var t="",a=0;a<e.length;a++)t=t+e[a]+" ";return t},updateMovie:function(){var e=this;this.loading=!0;var t=this.arrayToString(this.movieForm.casts),a=this.arrayToString(this.movieForm.directors),s=new FormData;s.append("movie_id",this.$route.params.movieid),s.append("douban_id",this.movieForm.douban_id),s.append("title",this.movieForm.title),s.append("subtype",this.movieForm.subtype),s.append("year",this.movieForm.year),s.append("image",this.movieForm.image.raw),s.append("countries",this.movieForm.countries),s.append("genres_name",this.movieForm.genres),s.append("original_title",this.movieForm.original_title),s.append("summary",this.movieForm.summary),s.append("aka",this.movieForm.aka),s.append("director_ids",a),s.append("celebrities_ids",t),"tv"===this.movieForm.subtype?(s.append("seasons_count",this.movieForm.seasons_count),s.append("episodes_count",this.movieForm.episodes_count),s.append("current_season",this.movieForm.current_season)):s.append("cinema_status",this.movieForm.cinema_status),this.$http.patch("/movie",s).then(function(t){e.loading=!1,e.$message.success("电影信息修改成功")}).catch(function(t){e.loading=!1,e.$message.error("修改失败,请检查信息后再试")})}}}),zs=Us,Bs=Object(d["a"])(zs,As,Ls,!1,null,null,null),Vs=Bs.exports,Js=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"head"},[a("span",{staticClass:"title"},[e._v("修改影人信息")]),a("br"),a("br"),a("el-form",{ref:"celebrityForm",staticClass:"celebrity-form",attrs:{model:e.celebrityForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"影人名称",prop:"name"}},[a("el-input",{model:{value:e.celebrityForm.name,callback:function(t){e.$set(e.celebrityForm,"name",t)},expression:"celebrityForm.name"}})],1),a("el-form-item",{attrs:{label:"影人性别",prop:"gender"}},[a("el-select",{attrs:{placeholder:"请选择性别"},model:{value:e.celebrityForm.gender,callback:function(t){e.$set(e.celebrityForm,"gender",t)},expression:"celebrityForm.gender"}},[a("el-option",{attrs:{label:"男",value:"male"}}),a("el-option",{attrs:{label:"女",value:"female"}})],1)],1),a("el-form-item",{attrs:{label:"豆瓣ID",prop:"douban_id"}},[a("el-input",{model:{value:e.celebrityForm.douban_id,callback:function(t){e.$set(e.celebrityForm,"douban_id",t)},expression:"celebrityForm.douban_id"}})],1),a("el-form-item",{attrs:{label:"英文名",prop:"nama_en"}},[a("el-input",{model:{value:e.celebrityForm.nama_en,callback:function(t){e.$set(e.celebrityForm,"nama_en",t)},expression:"celebrityForm.nama_en"}})],1),a("el-form-item",{attrs:{label:"出生地",prop:"born_place"}},[a("el-input",{model:{value:e.celebrityForm.born_place,callback:function(t){e.$set(e.celebrityForm,"born_place",t)},expression:"celebrityForm.born_place"}})],1),a("el-form-item",{attrs:{label:"又名",prop:"aka"}},[a("el-input",{attrs:{placeholder:"多个又名以'/'分割"},model:{value:e.celebrityForm.aka,callback:function(t){e.$set(e.celebrityForm,"aka",t)},expression:"celebrityForm.aka"}})],1),a("el-form-item",{attrs:{label:"外文名",prop:"aka_en"}},[a("el-input",{attrs:{placeholder:"多个外文名以'/'分割"},model:{value:e.celebrityForm.aka_en,callback:function(t){e.$set(e.celebrityForm,"aka_en",t)},expression:"celebrityForm.aka_en"}})],1),a("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"","file-list":e.celebrityForm.avatarFile,"auto-upload":!1,"on-change":e.handleChange,"show-file-list":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过2Mb")])],1)],1),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm("celebrityForm")}}},[e._v("修改信息")]),a("el-button",{on:{click:function(t){return e.resetForm("celebrityForm")}}},[e._v("重置")])],1)],1)],1)},Gs=[],Zs={data:function(){return{celebrityForm:{name:"",gender:"",douban_id:"",name_en:"",born_place:"",aka:"",aka_en:"",avatar:[]},rules:{name:[{required:!0,message:"请输入影人姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择艺人性别",trigger:"change"}]},loading:!1}},created:function(){this.fetchCelebrityInfo()},methods:{handleChange:function(e,t){var a=e.size/1024/1024<2,s="image/jpeg"===e.raw.type||"image/png"===e.raw.type;return a?s?(this.$message.success("添加头像成功"),void(this.celebrityForm.avatar=e)):(this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),!1):(this.$message.error("上传文件大小不能超过 2MB!"),!1)},resetForm:function(e){this.$refs[e].resetFields()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){return e?t.celebrityForm.avatar?void t.updateCelebrity():(t.$message.error("请添加头像"),!1):(console.log("error submit!!"),!1)})},fetchCelebrityInfo:function(){var e=this,t="/celebrity/"+this.$route.params.celebrityid;this.$http.get(t).then(function(t){var a=t.data.data;if(console.log(a),e.celebrityForm.name=a.name,0===a.gender?e.celebrityForm.gender="male":e.celebrityForm.gender="female",e.celebrityForm.name_en=a.name,e.celebrityForm.born_place=a.born_place,a.aka_list)for(var s=0;s<a.aka_list.length;s++)e.celebrityForm.aka+=a.aka_list[s]+"/";if(a.aka_en_list)for(s=0;s<a.aka_en_list.length;s++)e.celebrityForm.aka_en+=a.aka_en_list[s]+"/";e.celebrityForm.douban_id=a.douban_id,e.loading=!1}).catch(function(t){e.$message.error("未找到相关信息"),e.$router.push("/"),console.log("fetch celebrity info error."),e.loading=!1})},updateCelebrity:function(){var e=this;this.loading=!0;var t=new FormData;t.append("image",this.celebrityForm.avatar.raw),t.append("name",this.celebrityForm.name),t.append("douban_id",this.celebrityForm.douban_id),t.append("gender",this.celebrityForm.gender),t.append("name_en",this.celebrityForm.name_en),t.append("born_place",this.celebrityForm.born_place),t.append("aka",this.celebrityForm.aka),t.append("aka_en",this.celebrityForm.aka_en),this.$http.patch("/celebrity/"+this.$route.params.celebrityid,t).then(function(t){e.loading=!1,e.$message.success("影人信息修改成功")}).catch(function(t){e.loading=!1,e.$message.error("修改失败,请稍后再试")})}}},Hs=Zs,Ys=(a("d555"),Object(d["a"])(Hs,Js,Gs,!1,null,null,null)),Qs=Ys.exports;i["default"].use(_["a"]);var Ks=new _["a"]({mode:"history",base:"/",routes:[{path:"/admin",component:qs,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/notification",component:fs,meta:{requiresAuth:!0}},{path:"/setting",component:Qa,meta:{requiresAuth:!0}},{path:"/explore",name:"choice movies",component:fa,meta:{requiresAuth:!0}},{path:"/chart",component:la,meta:{requiresAuth:!0}},{path:"/recommend",component:aa,meta:{requiresAuth:!0}},{path:"/cinema",component:Qt,meta:{requiresAuth:!0}},{path:"/people/:username/:cate",name:"friends",component:qt,props:!0,meta:{requiresAuth:!0}},{path:"/celebrity/:celebrityid",name:"celebrity",props:!0,component:kt,meta:{requiresAuth:!0}},{path:"/celebrity/:celebrityid/update",name:"updateCelebrity",component:Qs,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/",name:"home",component:S,meta:{requiresAuth:!0}},{path:"/sign",name:"sign",component:Y,meta:{requiresAuth:!1}},{path:"/login",name:"login",component:pe},{path:"/movie/:movieid",name:"moviePage",props:!0,component:$e,meta:{requiresAuth:!0}},{path:"/movie/:movieid/update",name:"updateMovie",component:Vs,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/people/:username",name:"peoplePage",props:!0,component:lt,meta:{requiresAuth:!0}},{path:"*",name:"404NotFound",component:j,meta:{requiresAuth:!1}},{path:"/auth/confirm-email",name:"comfirnEmail",component:Se},{path:"/auth/forget-password",name:"sentResetPasswordEmail",component:je},{path:"/auth/reset-password",name:"resetPassword",component:Be},{path:"/auth/change-email",name:"changeEmail",component:Ye,meta:{requiresAuth:!1}}]}),Ws=a("2f62");i["default"].use(Ws["a"]);var Xs=new Ws["a"].Store({state:{isLogin:localStorage.getItem("isLogin")||!1,token:localStorage.getItem("token")||"",username:localStorage.getItem("username")||"",messageCount:"0",role:localStorage.getItem("role")||""},mutations:{changeLogin:function(e,t){e.isLogin=t,localStorage.setItem("isLogin",t)},changeMessageCount:function(e,t){e.messageCount=t},setUsername:function(e,t){localStorage.setItem("username",t),e.username=t},setRole:function(e,t){e.role=t,localStorage.setItem("role",t)},setToken:function(e,t){localStorage.setItem("token",t),e.token=t}},actions:{}}),eo=a("5c96"),to=a.n(eo);a("0fae");i["default"].use(to.a);var ao=a("bc3a"),so=a.n(ao),oo=(a("92c6"),a("619b"),a("7e79")),io=a.n(oo);so.a.defaults.baseURL="http://localhost:5000/api/v2";var ro=Xs.state.token;console.log("111"),ro&&(so.a.defaults.headers.common["Authorization"]="bearer "+ro),Ks.beforeEach(function(e,t,a){var s=localStorage.getItem("isLogin");e.meta.noLogin&&(s?(console.log("here"),a("/")):a()),e.meta.requiresAuth?"true"===s?a():a({path:"/login"}):a(),e.meta.requiresAdmin&&("user"===Xs.state.role?a({path:"/"}):a())}),so.a.interceptors.response.use(function(e){return e},function(e){if(e.response){if(401!==e.response.status)return o.a.reject(e);Ks.replace({path:"/login"}),localStorage.removeItem("token"),localStorage.removeItem("isLogin")}}),i["default"].use(io.a),i["default"].prototype.$http=so.a,i["default"].config.productionTip=!1,new i["default"]({router:Ks,store:Xs,render:function(e){return e(b)}}).$mount("#app")},"5cf8":function(e,t,a){"use strict";var s=a("8d66"),o=a.n(s);o.a},"60a1":function(e,t,a){},"60fd":function(e,t,a){"use strict";var s=a("bed9"),o=a.n(s);o.a},"62c6":function(e,t,a){"use strict";var s=a("dda4"),o=a.n(s);o.a},"650c":function(e,t,a){"use strict";var s=a("e3b0"),o=a.n(s);o.a},"65d0":function(e,t,a){},"6f7c":function(e,t,a){"use strict";var s=a("c84b"),o=a.n(s);o.a},"746e":function(e,t,a){},7584:function(e,t,a){},7945:function(e,t,a){"use strict";var s=a("04ca"),o=a.n(s);o.a},"7ad9":function(e,t,a){"use strict";var s=a("91cf"),o=a.n(s);o.a},"82d0":function(e,t,a){},"84a9":function(e,t,a){"use strict";var s=a("a7b1"),o=a.n(s);o.a},"8bb3":function(e,t,a){"use strict";var s=a("b677"),o=a.n(s);o.a},"8d66":function(e,t,a){},"8df2":function(e,t,a){"use strict";var s=a("96e0"),o=a.n(s);o.a},"8e87":function(e,t,a){"use strict";var s=a("0b4d"),o=a.n(s);o.a},9017:function(e,t,a){},"91cf":function(e,t,a){},9256:function(e,t,a){"use strict";var s=a("431a"),o=a.n(s);o.a},"96e0":function(e,t,a){},"9a49":function(e,t,a){},a7b1:function(e,t,a){},a9e7:function(e,t,a){},b26c:function(e,t,a){},b2b1:function(e,t,a){"use strict";var s=a("d3f3"),o=a.n(s);o.a},b677:function(e,t,a){},bed9:function(e,t,a){},bf00:function(e,t,a){},bff1:function(e,t,a){"use strict";var s=a("2463"),o=a.n(s);o.a},c2f6:function(e,t,a){},c329:function(e,t,a){"use strict";var s=a("82d0"),o=a.n(s);o.a},c650:function(e,t,a){"use strict";var s=a("60a1"),o=a.n(s);o.a},c84b:function(e,t,a){},c9b7:function(e,t,a){"use strict";var s=a("2252"),o=a.n(s);o.a},cc26:function(e,t,a){"use strict";var s=a("7584"),o=a.n(s);o.a},ce8c:function(e,t,a){"use strict";var s=a("65d0"),o=a.n(s);o.a},d024:function(e,t,a){"use strict";var s=a("9a49"),o=a.n(s);o.a},d3f3:function(e,t,a){},d524:function(e,t,a){"use strict";var s=a("9017"),o=a.n(s);o.a},d555:function(e,t,a){"use strict";var s=a("1e81"),o=a.n(s);o.a},d6db:function(e,t,a){"use strict";var s=a("a9e7"),o=a.n(s);o.a},dda4:function(e,t,a){},de16:function(e,t,a){"use strict";var s=a("f3e7"),o=a.n(s);o.a},e0b7:function(e,t,a){"use strict";var s=a("c2f6"),o=a.n(s);o.a},e157:function(e,t,a){"use strict";var s=a("53f6"),o=a.n(s);o.a},e28c:function(e,t,a){"use strict";var s=a("b26c"),o=a.n(s);o.a},e3b0:function(e,t,a){},e5ed:function(e,t,a){},ea1c:function(e,t,a){},ec6f:function(e,t,a){},f2ff:function(e,t,a){"use strict";var s=a("ea1c"),o=a.n(s);o.a},f3e7:function(e,t,a){}});
//# sourceMappingURL=app.d665c944.js.map